{"version":3,"sources":["../../src/Image/Image.js"],"names":["Image","props","company","BrandContext","imageUrl","imageProcessorPath","mountSrcUrl","imgUrl","setImgUrl","fallbackPosition","setFallbackPosition","alt","className","onError","fallback","fallbackUrl","properties","src","width","height","newImgUrl","prevState","propTypes","PropTypes","string","isRequired","array","number","improveOriginalImage","scaleImage","path","pathSlices","unshift","join","step1","step2","steps","styles","withTheme"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from \"react\";\nimport { BrandContext } from \"../BrandContext/BrandContext\";\nimport { withStyles } from \"@material-ui/styles\";\nimport PropTypes from \"prop-types\";\nimport { styles } from \"./styles\";\n\nconst Image = props => {\n    // TODO rever implementação do contexto\n    var company = useContext(BrandContext);\n    const imageUrl = company ? `${company.imageProcessorPath}image/fetch` : \"\";\n    const [imgUrl, setImgUrl] = useState(mountSrcUrl(props, imageUrl));\n    const [fallbackPosition, setFallbackPosition] = useState(0);\n    const { alt, className } = props;\n\n    const onError = () => {\n        if (props.fallback || props.fallbackUrl) {\n            const properties = { src: props.fallbackUrl ? props.fallbackUrl : props.fallback[fallbackPosition], width: props.width, height: props.height };\n            const newImgUrl = mountSrcUrl(properties, imageUrl);\n            setImgUrl(newImgUrl);\n            props.fallback && setFallbackPosition(prevState => prevState + 1);\n        }\n    };\n\n    return (\n        <>\n            <img src={imgUrl} alt={alt} className={className} onError={onError} />\n        </>\n    );\n};\n\nImage.propTypes = {\n    className: PropTypes.string,\n    alt: PropTypes.string,\n    src: PropTypes.string.isRequired,\n    fallbackUrl: PropTypes.string,\n    fallback: PropTypes.array,\n    width: PropTypes.number,\n    height: PropTypes.number\n};\n\n/**\n * Mounts the url based on the component props\n * The sequence of efects matters! The effect is applyed to the output of the previous one\n */\nfunction mountSrcUrl({ src, width, height }, imageUrl) {\n    imageUrl = improveOriginalImage(imageUrl);\n    imageUrl = scaleImage(imageUrl, width, height);\n    return `${imageUrl}/${src}`;\n}\n\n/**\n * Width - adds width and Height dimensions\n */\nfunction scaleImage(path, width, height) {\n    const pathSlices = [\"c_fill\"];\n    if (width) pathSlices.unshift(`w_${width}`);\n    if (height) pathSlices.unshift(`h_${height}`);\n    return `${path}/${pathSlices.join(\",\")}`;\n}\n\n/**\n * Sharpen - Improves contrast without loosing quality\n */\nfunction improveOriginalImage(path) {\n    const step1 = [\"e_trim\"];\n    const step2 = [\"e_sharpen\", \"f_auto\", \"fl_lossy\"];\n    const steps = [step1.join(\",\"), step2.join(\",\")];\n    return `${path}/${steps.join(\"/\")}`;\n}\n\nexport default withStyles(styles, { withTheme: true })(Image);\n"],"file":"Image.js"}