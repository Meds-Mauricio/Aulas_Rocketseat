"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _propTypes=_interopRequireDefault(require("prop-types"));var _withStyles=_interopRequireDefault(require("@material-ui/core/styles/withStyles"));var _ListItem=_interopRequireDefault(require("@material-ui/core/ListItem"));var _InputBase=_interopRequireDefault(require("@material-ui/core/InputBase"));var _List=_interopRequireDefault(require("@material-ui/core/List"));var _MultipleDestinations=_interopRequireDefault(require("@cvccorp-components/icons/dist/MultipleDestinations"));var _Clock=_interopRequireDefault(require("@cvccorp-components/icons/dist/Clock"));var _ArrowLeft=_interopRequireDefault(require("@cvccorp-components/icons/dist/ArrowLeft"));var _ErrorIcon=_interopRequireDefault(require("@cvccorp-components/icons/dist/ErrorIcon"));var _Typography=_interopRequireDefault(require("../../Typography"));var _Box=_interopRequireDefault(require("../../Box"));var _TextField=_interopRequireDefault(require("../../TextField"));var _Overlay=_interopRequireDefault(require("../../Overlay"));var _Animate=_interopRequireDefault(require("../../Animate"));var _styles=require("../styles");var _BrandContext=require("../../BrandContext/BrandContext");function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap;var cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{"default":obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly){symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})}keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2["default"])(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}var mergeClasses=function mergeClasses(classes){return classes.join(" ")};var tourClasses=function tourClasses(theme){return{fieldContainer:{position:"relative"},destinationscontainer:{position:"absolute",top:"50%",left:"50px",maxWidth:"calc(100% - 50px)",overflowY:"auto",width:"auto",display:"inline-flex",transform:"translateY(-50%)",whiteSpace:"nowrap"},destinationField:{margin:"0 4px",padding:"4px 10px",border:"1px solid",borderRadius:"16px",fontSize:"12px",fontWeight:700},destinationFieldTransparent:{color:theme.palette.white.main,borderColor:theme.palette.white.main},destinationInput:{color:"transparent"},closeButton:{width:"24px",marginLeft:"8px",marginRight:"-4px",color:theme.palette.secondary.main},destinationInputLabel:{paddingLeft:"8px"}}};var PesqincTour=function PesqincTour(_ref){var classes=_ref.classes,onChange=_ref.onChange,onFocus=_ref.onFocus,onClose=_ref.onClose,onSelect=_ref.onSelect,value=_ref.value,selectedIndex=_ref.selectedIndex,transparent=_ref.transparent,search=_ref.search,isMobile=_ref.isMobile,error=_ref.error,errorMsg=_ref.errorMsg,history=_ref.history,mostSearched=_ref.mostSearched,initialDestinations=_ref.destinations;var _useState=(0,_react.useState)(selectedIndex||0),_useState2=(0,_slicedToArray2["default"])(_useState,2),index=_useState2[0],setIndex=_useState2[1];var _useState3=(0,_react.useState)(false),_useState4=(0,_slicedToArray2["default"])(_useState3,2),searching=_useState4[0],setSearching=_useState4[1];var _useState5=(0,_react.useState)(null),_useState6=(0,_slicedToArray2["default"])(_useState5,2),selectedItem=_useState6[0],setSelectedItem=_useState6[1];var _useState7=(0,_react.useState)(false),_useState8=(0,_slicedToArray2["default"])(_useState7,2),loaded=_useState8[0],setLoaded=_useState8[1];var _useState9=(0,_react.useState)(initialDestinations?initialDestinations:[]),_useState10=(0,_slicedToArray2["default"])(_useState9,2),destinations=_useState10[0],setDestinations=_useState10[1];var _useContext=(0,_react.useContext)(_BrandContext.BrandContext),brandTheme=_useContext.theme;(0,_react.useEffect)(function(){setLoaded(true)},[]);(0,_react.useEffect)(function(){if(initialDestinations){setDestinations(initialDestinations);onSelect(initialDestinations)}},[initialDestinations]);var addDestination=function addDestination(destination){var destinationName=destination.name;if(destinations.find(function(d){var _d$name;return((_d$name=d.name)===null||_d$name===void 0?void 0:_d$name.indexOf(destinationName))!==-1||false})){return}var newDestinations=destinations;newDestinations.push(destination);setDestinations(newDestinations)};var removeDestination=function removeDestination(destination){var destinationName=destination.name;var newDestinations=destinations.filter(function(d){return d.name!==destinationName});setDestinations(newDestinations);onSelect(newDestinations)};var handleSelect=function handleSelect(item,index){setSearching(false);setSelectedItem(item);addDestination(item);onSelect(destinations)};var handleKeyUp=function handleKeyUp(e){if(search&&search.length>0){if(e.keyCode===40)setIndex((index+1)%search.length);else if(e.keyCode===38)setIndex((index-1+search.length)%search.length);else if(e.keyCode===13&&searching){addDestination(search[index]);onSelect(destinations);setSearching(false)}}};var handleChange=function handleChange(e){if(onChange)onChange(e)};var handleFocus=function handleFocus(e){setSearching(true);if(onFocus)onFocus(e)};var handleClose=function handleClose(){if(window!==undefined&&isMobile){window.scrollTo(0,0)}if(!selectedItem||value!==selectedItem.name){setSelectedItem(null)}setSearching(false);if(onClose)onClose(selectedItem)};var _useState11=(0,_react.useState)(false),_useState12=(0,_slicedToArray2["default"])(_useState11,2),isOpenAnimation=_useState12[0],setOpenAnimation=_useState12[1];var onOpenAnimate=function onOpenAnimate(){setOpenAnimation(true);document.getElementById("pesqinc-input").focus()};var onCloseAnimate=function onCloseAnimate(){setOpenAnimation(false)};var renderDestinationsContainer=function renderDestinationsContainer(){if(!destinations||!destinations[0]){return}var renderDestination=function renderDestination(destination,index){return/*#__PURE__*/_react["default"].createElement("div",{key:"rDest-".concat(index),className:mergeClasses([classes.destinationField,classes.destinationFieldTransparent])},/*#__PURE__*/_react["default"].createElement(_Typography["default"],null,destination.name),/*#__PURE__*/_react["default"].createElement("span",{onClick:function onClick(){return removeDestination(destination)}},/*#__PURE__*/_react["default"].createElement(_ErrorIcon["default"],{className:classes.closeButton})))};return/*#__PURE__*/_react["default"].createElement("div",{className:classes.destinationscontainer},destinations.map(function(d,i){return renderDestination(d,i)}))};var textLabel=function textLabel(){return destinations[0]?"":"Para onde vai?"};return/*#__PURE__*/_react["default"].createElement("div",{className:classes.container},loaded&&/*#__PURE__*/_react["default"].createElement("div",{className:mergeClasses([classes.fieldContainer,"fieldContainer"])},/*#__PURE__*/_react["default"].createElement(_TextField["default"],{label:textLabel(),size:"large",transparent:transparent,onClick:handleFocus,onChange:handleChange,onKeyUp:handleKeyUp,inputClassName:mergeClasses([classes.input,classes.destinationInput]),labelClassName:mergeClasses([classes.input,classes.destinationInputLabel]),error:error,errorMsg:errorMsg,icon:/*#__PURE__*/_react["default"].createElement(_MultipleDestinations["default"],{noStroke:true,size:"large"}),disabled:true,noBorder:true}),renderDestinationsContainer()),/*#__PURE__*/_react["default"].createElement(_Animate["default"],{isOpen:searching,onOpen:onOpenAnimate,onClose:onCloseAnimate},handleClose&&/*#__PURE__*/_react["default"].createElement(_Overlay["default"],{onClick:handleClose}),/*#__PURE__*/_react["default"].createElement(_Box["default"],{className:"".concat(classes.root," ").concat(!isOpenAnimation&&classes.closed)},/*#__PURE__*/_react["default"].createElement("div",{className:classes.internalInput},isMobile?/*#__PURE__*/_react["default"].createElement("a",{onClick:handleClose},/*#__PURE__*/_react["default"].createElement(_ArrowLeft["default"],null)):/*#__PURE__*/_react["default"].createElement(_MultipleDestinations["default"],{noStroke:true,size:"medium"}),/*#__PURE__*/_react["default"].createElement(_InputBase["default"],{placeholder:"Para onde vai?",onFocus:handleFocus,onChange:handleChange,onKeyUp:function onKeyUp(e){return handleKeyUp(e,value)},className:classes.flexGrow,id:"pesqinc-input",autoComplete:"off"})),/*#__PURE__*/_react["default"].createElement("div",{className:classes.boxResult},!history&&(!search||search.length===0)&&!mostSearched&&/*#__PURE__*/_react["default"].createElement(_Typography["default"],{type:"captionsemibold",className:classes.listItemTitle},"Continue digitando\u2026"),/*#__PURE__*/_react["default"].createElement(_List["default"],{component:"nav",className:classes.list},search&&search.length>0&&/*#__PURE__*/_react["default"].createElement("li",{className:classes.listItemTitle},/*#__PURE__*/_react["default"].createElement(_Typography["default"],{type:"captionsemibold"},"Voc\xEA est\xE1 buscando por\u2026")),/*#__PURE__*/_react["default"].createElement("div",{className:"".concat(!isMobile&&classes.heightLimit," ").concat(classes.scrolling)},search&&search.map(function(item,i){return/*#__PURE__*/_react["default"].createElement(_ListItem["default"],{key:i,className:classes.listItem,button:true,selected:i===index,onClick:function onClick(){return handleSelect(item,i)}},item.type==="location"&&/*#__PURE__*/_react["default"].createElement(_MultipleDestinations["default"],{size:"small",noStroke:true}),/*#__PURE__*/_react["default"].createElement("span",{className:classes.content},/*#__PURE__*/_react["default"].createElement(_Typography["default"],{className:classes.name,type:"body2semibold"},item.name),/*#__PURE__*/_react["default"].createElement(_Typography["default"],{className:classes.adressHotel,type:"body2regular"}," - ",item.address)))})),history&&!(search&&search.length>0)&&/*#__PURE__*/_react["default"].createElement("li",{className:classes.listItemTitle},/*#__PURE__*/_react["default"].createElement(_Typography["default"],{type:"captionsemibold"},"\xDAltimas buscas")),history&&!(search&&search.length>0)&&history.map(function(item,i){return/*#__PURE__*/_react["default"].createElement(_ListItem["default"],{key:i,className:classes.listItem,button:true,onClick:function onClick(){return handleSelect(item,i)}},/*#__PURE__*/_react["default"].createElement(_Clock["default"],{size:"small"}),/*#__PURE__*/_react["default"].createElement("span",{className:classes.content},/*#__PURE__*/_react["default"].createElement(_Typography["default"],{className:classes.name,type:"body2semibold"},item.name)))}),mostSearched&&!(search&&search.length>0)&&/*#__PURE__*/_react["default"].createElement("li",{className:classes.listItemTitle},/*#__PURE__*/_react["default"].createElement(_Typography["default"],{type:"captionsemibold"},"Destinos mais buscados")),mostSearched&&!(search&&search.length>0)&&mostSearched.map(function(item,i){return/*#__PURE__*/_react["default"].createElement(_ListItem["default"],{key:i,className:classes.listItem,button:true,onClick:function onClick(){return handleSelect(item,i)}},(item.type==="location"||!item.type)&&/*#__PURE__*/_react["default"].createElement(_MultipleDestinations["default"],{size:"small",noStroke:true}),/*#__PURE__*/_react["default"].createElement("span",{className:classes.content},/*#__PURE__*/_react["default"].createElement(_Typography["default"],{className:classes.name,type:"body2semibold"},item.name)))}))))))};PesqincTour.propTypes={classes:_propTypes["default"].object.isRequired,search:_propTypes["default"].array,history:_propTypes["default"].array,mostSearched:_propTypes["default"].array,onChange:_propTypes["default"].func,onFocus:_propTypes["default"].func,onClose:_propTypes["default"].func,onSelect:_propTypes["default"].func,value:_propTypes["default"].array,selectedIndex:_propTypes["default"].number,transparent:_propTypes["default"].bool,isMobile:_propTypes["default"].bool,error:_propTypes["default"].bool,errorMsg:_propTypes["default"].string,destinations:_propTypes["default"].array};var mergeStyles=function mergeStyles(theme){return _objectSpread(_objectSpread({},(0,_styles.styles)(theme)),tourClasses(theme))};var _default=(0,_withStyles["default"])(mergeStyles,{withTheme:true})(PesqincTour);exports["default"]=_default;
//# sourceMappingURL=PesqincTour.js.map