"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _react=_interopRequireWildcard(require("react"));var _awsAmplify=require("aws-amplify");var _reactIntl=require("react-intl");var Yup=_interopRequireWildcard(require("yup"));var _ProfileContext=require("../../../ProfileContext");var _useGa2=_interopRequireDefault(require("../../../utils/useGa"));var _AmplifyContext=require("../../contexts/AmplifyContext");var _renderSteps=require("../../contexts/renderSteps");var _Toast=require("../../contexts/Toast");var _Form=_interopRequireDefault(require("../../shared/components/Form"));var _HeaderLogin=_interopRequireDefault(require("../../shared/components/HeaderLogin"));var _Input=_interopRequireDefault(require("../../shared/components/Input"));var _InternalButton=_interopRequireDefault(require("../../shared/components/InternalButton"));var _Terms=_interopRequireDefault(require("../../shared/components/Terms"));var _Title=_interopRequireDefault(require("../../shared/components/Title"));var _UserContext=require("../../shared/hooks/UserContext");var _translate=_interopRequireDefault(require("../../shared/i18n/translate"));var _getValidationErrors=_interopRequireDefault(require("../../shared/utils/getValidationErrors"));function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap;var cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{"default":obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}var NewRegister=function NewRegister(_ref){var intl=_ref.intl,onCloseClick=_ref.onCloseClick,isModal=_ref.isModal;var _useUserData=(0,_UserContext.useUserData)(),user=_useUserData.user;var _useRenderSteps=(0,_renderSteps.useRenderSteps)(),renderNewStep=_useRenderSteps.renderNewStep,setPreviousStep=_useRenderSteps.setPreviousStep;var _useAuthAmplifyContex=(0,_AmplifyContext.useAuthAmplifyContext)(),setAuthAmplify=_useAuthAmplifyContex.setAuthAmplify,setAmplifyPwd=_useAuthAmplifyContex.setAmplifyPwd;var title=(0,_translate["default"])({id:"NewRegister.title"});var placeHolderPwd=(0,_translate["default"])({id:"NewRegister.placeHolderPwd"});var placeHolderConfirmPwd=(0,_translate["default"])({id:"NewRegister.placeHolderConfirmPwd"});var errorPasswordRequired=intl.formatMessage({id:"NewRegister.errorPasswordRequired"});var errorPasswordMatch=intl.formatMessage({id:"NewRegister.errorPasswordMatch"});var errorMatchPwds=intl.formatMessage({id:"NewRegister.errorMatchPwds"});var successToastMessageTitle=intl.formatMessage({id:"NewRegister.successToastMessageTitle"});var successToastMessageDescription=intl.formatMessage({id:"NewRegister.successToastMessageDescription"});var errorToastMessageTitle=intl.formatMessage({id:"NewRegister.errorToastMessageTitle"});var errorToastMessageDescription=intl.formatMessage({id:"NewRegister.errorToastMessageDescription"});var _useGa=(0,_useGa2["default"])(),saveOnGa=_useGa.saveOnGa;var _useProfileContext=(0,_ProfileContext.useProfileContext)(),setIsRegisterUserProfileStepToggle=_useProfileContext.setIsRegisterUserProfileStepToggle;var formRef=(0,_react.useRef)(null);var _useToast=(0,_Toast.useToast)(),addToast=_useToast.addToast;(0,_react.useEffect)(function(){setPreviousStep("ConfirmMainScreen");setIsRegisterUserProfileStepToggle(true)},[setIsRegisterUserProfileStepToggle,setPreviousStep]);var submitForm=(0,_react.useCallback)(/*#__PURE__*/function(){var _ref2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee2(formData){return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",new Promise(/*#__PURE__*/function(){var _ref3=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee(resolve){var _formRef$current,_formRef$current3,password,confirmPassword,schema,_formRef$current2,email,pwd,_formRef$current4;return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;(_formRef$current=formRef.current)===null||_formRef$current===void 0?void 0:_formRef$current.setErrors({});password=formData.password,confirmPassword=formData.confirmPassword;schema=Yup.object().shape({password:Yup.string().matches(/^(?=.*[0-9|#?!@$%^&*-]).{8,}$/,errorPasswordMatch).required(errorPasswordRequired)});_context.next=6;return schema.validate(formData,{abortEarly:false});case 6:if(!(password!==confirmPassword)){_context.next=9;break}(_formRef$current2=formRef.current)===null||_formRef$current2===void 0?void 0:_formRef$current2.setErrors({confirmPassword:errorMatchPwds});return _context.abrupt("return");case 9:(_formRef$current3=formRef.current)===null||_formRef$current3===void 0?void 0:_formRef$current3.setErrors({confirmPassword:""});email=user.email;pwd=formData.password;_context.next=14;return SignUp(email,pwd);case 14:resolve("Success");setAuthAmplify("confirmSignUp");saveOnGa({event:"login_event",category:"Account",action:"Registration",label:"step 2 | password registration"});renderNewStep("ValidationCode");_context.next=23;break;case 20:_context.prev=20;_context.t0=_context["catch"](0);if(_context.t0 instanceof Yup.ValidationError){(_formRef$current4=formRef.current)===null||_formRef$current4===void 0?void 0:_formRef$current4.setErrors((0,_getValidationErrors["default"])(_context.t0))}case 23:case"end":return _context.stop();}}},_callee,null,[[0,20]])}));return function(_x2){return _ref3.apply(this,arguments)}}()));case 1:case"end":return _context2.stop();}}},_callee2)}));return function(_x){return _ref2.apply(this,arguments)}}(),[]);var SignUp=function SignUp(email,pwd){return new Promise(/*#__PURE__*/function(){var _ref4=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee3(resolve){return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return _awsAmplify.Auth.signUp({username:email,password:pwd});case 3:setAmplifyPwd(pwd);resolve("Success");addToast({type:"success",title:successToastMessageTitle,description:successToastMessageDescription});_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3["catch"](0);addToast({type:"error",title:errorToastMessageTitle,description:errorToastMessageDescription});case 11:case"end":return _context3.stop();}}},_callee3,null,[[0,8]])}));return function(_x3){return _ref4.apply(this,arguments)}}())};return/*#__PURE__*/_react["default"].createElement(_react["default"].Fragment,null,/*#__PURE__*/_react["default"].createElement(_HeaderLogin["default"],{isModal:isModal,previousStep:"ConfirmMainScreen",onCloseClick:onCloseClick}),/*#__PURE__*/_react["default"].createElement(_Form["default"],{ref:formRef,handleSubmit:submitForm},/*#__PURE__*/_react["default"].createElement(_Title["default"],null,title),/*#__PURE__*/_react["default"].createElement(_Input["default"],{name:"password",placeholderText:placeHolderPwd,type:"password",showTip:true,infoMessage:errorPasswordMatch}),/*#__PURE__*/_react["default"].createElement(_Input["default"],{name:"confirmPassword",placeholderText:placeHolderConfirmPwd,type:"password",showTip:true,infoMessage:errorPasswordMatch}),/*#__PURE__*/_react["default"].createElement(_InternalButton["default"],{text:"Entrar",type:"submit"}),/*#__PURE__*/_react["default"].createElement(_Terms["default"],null)))};var _default=(0,_reactIntl.injectIntl)(NewRegister);exports["default"]=_default;
//# sourceMappingURL=index.js.map