{"version":3,"sources":["../../../../src/MyTravelLogin/UserAccessSteps/Password/index.tsx"],"names":["Password","intl","onCloseClick","isModal","classes","formRef","user","setUser","renderNewStep","setPreviousStep","ctx","BrandContext","linkChangeEmail","formatMessage","id","errorPasswordRequired","errorMessage","successToastMessageTitle","successToastMessageDescription","loading","setLoading","setAmplifyPwd","addToast","saveOnGa","hasDoneProfileReq","setHasDoneProfileReq","getProfileInformations","profileData","setUserIdToken","setIsUserAuth","SignIn","email","password","Auth","signIn","siginRes","storagedData","pool","storage","i","length","key","startsWith","endsWith","getItem","handleSignInSucces","type","title","description","event","category","action","label","window","location","href","hosts","requiredProfileInformations","name","birthdate","contact","cpf","handleSubmit","data","current","setErrors","schema","Yup","object","shape","string","required","validate","abortEarly","handleMainScreen","handleForgotPassword","root","emails","subTitle","cursor","marginLeft","link"],"mappings":"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","sourcesContent":["/* eslint-disable no-empty */\nimport React, { useRef, useCallback, useEffect, useState, useMemo, useContext } from \"react\";\nimport Link from \"@material-ui/core/Link\";\nimport { FormHandles } from \"@unform/core\";\nimport { Auth } from \"aws-amplify\";\nimport { IntlShape, injectIntl } from \"react-intl\";\nimport * as Yup from \"yup\";\nimport { BrandContext } from \"../../../BrandContext\";\nimport { Redirect } from \"../../../BrandContext/amplify/aws.config\"\nimport {useProfileContext} from \"../../../ProfileContext\"\nimport { useUserDataContext } from \"../../../UserContext\";\nimport { getParam , featureToggles, verifyIsBrand } from \"../../../utils\";\nimport useGa from \"../../../utils/useGa\";\nimport { useAuthAmplifyContext } from \"../../contexts/AmplifyContext\";\nimport { useLoadingContext } from \"../../contexts/LoadingContext\";\nimport { useRenderSteps } from \"../../contexts/renderSteps\";\nimport { useToast } from \"../../contexts/Toast\";\nimport Form from \"../../shared/components/Form\";\nimport HeaderLogin from \"../../shared/components/HeaderLogin\";\nimport Input from \"../../shared/components/Input\";\nimport InternalButton from \"../../shared/components/InternalButton\";\nimport Loading from \"../../shared/components/Loading\";\nimport SubTitle from \"../../shared/components/SubTitle\";\nimport Terms from \"../../shared/components/Terms\";\nimport Title from \"../../shared/components/Title\";\nimport { useUserData } from \"../../shared/hooks/UserContext\";\nimport translate from \"../../shared/i18n/translate\";\nimport useStyles from \"./styles\";\n\ninterface IPasswordProps {\n    password: string;\n}\n\ninterface TPasswordProps {\n    onCloseClick?(): void;\n    intl: IntlShape;\n    isModal?: boolean;\n}\n\ninterface ISignIn {\n    email: string\n    password:string\n}\n\nconst Password: React.FC<TPasswordProps> = ({ intl, onCloseClick, isModal }) => {\n    const classes = useStyles({});\n    const formRef = useRef<FormHandles>(null);\n    const { user, setUser } = useUserData();\n    const { renderNewStep, setPreviousStep } = useRenderSteps();\n    const ctx = useContext(BrandContext);\n    const linkChangeEmail = intl.formatMessage({ id: \"Password.linkChangeEmail\" });\n    const errorPasswordRequired = intl.formatMessage({ id: \"Password.errorPasswordRequired\" });\n    const errorMessage = intl.formatMessage({ id: \"Password.errorMessage\" });\n    const successToastMessageTitle = intl.formatMessage({ id: \"Password.successToastMessageTitle\" });\n    const successToastMessageDescription = intl.formatMessage({ id: \"Password.successToastMessageDescription\" });\n    const { loading, setLoading } = useLoadingContext();\n    const { setAmplifyPwd } = useAuthAmplifyContext();\n    const { addToast } = useToast();\n    const { saveOnGa } = useGa();\n    const [hasDoneProfileReq , setHasDoneProfileReq] = useState(false)\n    const {  getProfileInformations, profileData  } = useProfileContext()\n    const { setUserIdToken, setIsUserAuth } = useUserDataContext();\n\n    const SignIn = useCallback( async({email, password}: ISignIn) => {\n        const siginRes =  await Auth.signIn(email, password);\n        const storagedData = siginRes?.pool?.storage\n\n        for (let i = 0; i < storagedData.length; i += 1) {\n            const key = storagedData.key(i)\n            if (key.startsWith(\"CognitoIdentityServiceProvider\") && key.endsWith(\"idToken\")) {\n                setUserIdToken(storagedData.getItem(key));\n            }\n        }\n        setAmplifyPwd(password);\n        if (featureToggles(ctx, \"PROFILE\")) {\n            setHasDoneProfileReq(true)\n        }else {\n            handleSignInSucces()\n        }\n    }, [setAmplifyPwd, setUserIdToken])\n\n    const handleSignInSucces = useCallback(() => {\n        setIsUserAuth(true)\n        addToast({\n            type: \"success\",\n            title: successToastMessageTitle,\n            description: successToastMessageDescription,\n        });\n\n        saveOnGa({\n            event: \"login_event\",\n            category: \"Account\",\n            action: \"Form Login\",\n            label: \"loggedUser ok\"\n        });\n\n        if (isModal) {\n            if (onCloseClick) {\n                onCloseClick();\n            }\n        } else {\n            if (getParam(\"path\")) {\n                window.location.href = `${Redirect(ctx.hosts)}${getParam(\"path\")}`\n                return\n            }\n            window.location.href = `${Redirect(ctx.hosts)}/mytravels/reservations`;\n\n        }\n    }, [addToast, ctx.hosts, isModal, onCloseClick, saveOnGa, setIsUserAuth, successToastMessageDescription, successToastMessageTitle])\n\n    useEffect(() => {\n        if(hasDoneProfileReq){\n            setHasDoneProfileReq(false)\n            getProfileInformations()\n        }\n\n    }, [hasDoneProfileReq])\n\n    const requiredProfileInformations = useMemo(() => {\n        return !!profileData?.name && !!profileData?.birthdate && !!profileData?.contact && !!profileData?.cpf\n    }, [profileData])\n\n    useEffect(() => {\n        if(profileData?.email) {\n            setLoading(false);\n            if(!requiredProfileInformations) {\n                renderNewStep(\"AlmostThere\")\n                setPreviousStep(\"Password\")\n            }else {\n                handleSignInSucces()\n            }\n        }\n    }, [handleSignInSucces, profileData?.email, renderNewStep, requiredProfileInformations, setLoading, setPreviousStep])\n\n    const handleSubmit = useCallback(async (data: IPasswordProps): Promise<void> => {\n        try {\n            formRef.current?.setErrors({});\n            const schema = Yup.object().shape({\n                password: Yup.string().required(errorPasswordRequired),\n            });\n\n            await schema.validate(data, {\n                abortEarly: false\n            });\n\n            setLoading(true);\n            await SignIn({email: user.email, password: data.password})\n        } catch (error) {\n            setLoading(false);\n            formRef.current?.setErrors({ password: errorMessage });\n        }\n    }, [SignIn, errorMessage, errorPasswordRequired, setLoading, user.email]);\n\n    const handleMainScreen = () => {\n        saveOnGa({\n            event: \"login_event\",\n            category: \"Account\",\n            action: \"change email\",\n            label: \"action :: change email\"\n        });\n        setUser({\n            ...user,\n            email: \"\"\n        });\n        renderNewStep(\"MainScreen\");\n    };\n\n    const handleForgotPassword = () => {\n        saveOnGa({\n            event: \"login_event\",\n            category: \"Account\",\n            action: \"Recovery Password\",\n            label: \"step 1 | forgot password\"\n        });\n        renderNewStep(\"ForgotPassword\");\n    };\n\n    if(loading) {\n        return <Loading />\n    }\n\n    return <>\n        <HeaderLogin isModal={isModal} previousStep=\"MainScreen\" onCloseClick={onCloseClick} />\n        <div className={classes.root}>\n            <Title>\n                {translate({ id: \"Password.title\" })}\n            </Title>\n            <div className={classes.emails}>\n                <SubTitle className={classes.subTitle} >\n                    {user ? user.email : \"\"}\n                </SubTitle>\n                <Link onClick={(handleMainScreen)} className={classes.cursor}>\n                    <SubTitle style={{ marginLeft: \"5px\" }} className={classes.subTitle} >\n                        {linkChangeEmail}\n                    </SubTitle>\n                </Link>\n            </div>\n\n            <Form ref={formRef} handleSubmit={handleSubmit} >\n                <Input\n                    type=\"password\"\n                    name=\"password\"\n                    placeholderText={translate({ id: \"Password.password\" })}\n                />\n                <InternalButton type=\"submit\" text={intl.formatMessage({ id: \"Password.actionButton\" })} />\n            </Form>\n\n            <Link\n                className={`${classes.cursor} ${classes.link}`}\n                onClick={() => handleForgotPassword()}\n            >\n                <SubTitle variant=\"caption\" className={classes.subTitle}>\n                    <b>{translate({ id: \"Password.forgotPassword\" })}</b>\n                </SubTitle>\n            </Link>\n\n        </div>\n        <Terms />\n    </>;\n};\n\nexport default injectIntl(Password);\n"],"file":"index.js"}