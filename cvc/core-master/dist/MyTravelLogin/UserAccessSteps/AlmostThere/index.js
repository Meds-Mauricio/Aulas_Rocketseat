"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _react=_interopRequireWildcard(require("react"));var _reactIntl=require("react-intl");var Yup=_interopRequireWildcard(require("yup"));var _ProfileContext=require("../../../ProfileContext");var _UserContext=require("../../../UserContext");var _Toast=require("../../contexts/Toast");var _Checkbox=_interopRequireDefault(require("../../shared/components/Checkbox"));var _Form=_interopRequireDefault(require("../../shared/components/Form"));var _HeaderLogin=_interopRequireDefault(require("../../shared/components/HeaderLogin"));var _Input=_interopRequireDefault(require("../../shared/components/Input"));var _InternalButton=_interopRequireDefault(require("../../shared/components/InternalButton"));var _SubTitle=_interopRequireDefault(require("../../shared/components/SubTitle"));var _Title=_interopRequireDefault(require("../../shared/components/Title"));var _getValidationErrors=_interopRequireDefault(require("../../shared/utils/getValidationErrors"));var _Redirect=_interopRequireDefault(require("../../shared/utils/Redirect"));var _styles=_interopRequireDefault(require("./styles"));function _getRequireWildcardCache(nodeInterop){if(typeof WeakMap!=="function")return null;var cacheBabelInterop=new WeakMap;var cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function _getRequireWildcardCache(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}function _interopRequireWildcard(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule){return obj}if(obj===null||_typeof(obj)!=="object"&&typeof obj!=="function"){return{"default":obj}}var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj)){return cache.get(obj)}var newObj={};var hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj){if(key!=="default"&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;if(desc&&(desc.get||desc.set)){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}newObj["default"]=obj;if(cache){cache.set(obj,newObj)}return newObj}/* eslint-disable @typescript-eslint/ban-ts-comment */ /* eslint-disable react-hooks/rules-of-hooks */ /* eslint-disable no-useless-escape */ /* eslint-disable no-extra-boolean-cast */var AlmostThere=function AlmostThere(_ref){var intl=_ref.intl,isModal=_ref.isModal,onCloseClick=_ref.onCloseClick;var almostThereTitle=intl.formatMessage({id:"AlmostThere.almostThereTitle"});var almostReadyTitle=intl.formatMessage({id:"AlmostThere.almostReadyTitle"});var almostThereSubTitle=intl.formatMessage({id:"AlmostThere.almostThereSubTitle"});var almostReadySubTitle=intl.formatMessage({id:"AlmostThere.almostReadySubTitle"});var inputPlaceholderBirthdate=intl.formatMessage({id:"AlmostThere.inputPlaceholderBirthdate"});var inputPlaceholderCPF=intl.formatMessage({id:"AlmostThere.inputPlaceholderCPF"});var inputInfoCPF=intl.formatMessage({id:"AlmostThere.inputInfoCPF"});var inputPlaceholderPhone=intl.formatMessage({id:"AlmostThere.inputPlaceholderPhone"});var inputPlaceholderName=intl.formatMessage({id:"AlmostThere.inputPlaceholderName"});var errorBirthdateIsRequired=intl.formatMessage({id:"AlmostThere.errorBirthdateIsRequired"});var errorInvalidFormmat=intl.formatMessage({id:"AlmostThere.errorInvalidFormmat"});var errorPhoneIsRequired=intl.formatMessage({id:"AlmostThere.errorPhoneIsRequired"});var errorCpfIsRequired=intl.formatMessage({id:"AlmostThere.errorCpfIsRequired"});var errorNameIsRequired=intl.formatMessage({id:"AlmostThere.errorNameIsRequired"});var termsAndConditionsPart1=intl.formatMessage({id:"AlmostThere.termsAndConditionsPart1"});var termsAndConditionsPart2=intl.formatMessage({id:"AlmostThere.termsAndConditionsPart2"});var termsAndConditionsPart3=intl.formatMessage({id:"AlmostThere.termsAndConditionsPart3"});var termsAndConditionsPart4=intl.formatMessage({id:"AlmostThere.termsAndConditionsPart4"});var termsAndConditionsPart5=intl.formatMessage({id:"AlmostThere.termsAndConditionsPart5"});var almostThereActionButton=intl.formatMessage({id:"AlmostThere.almostThereActionButton"});var almostReadyActionButton=intl.formatMessage({id:"AlmostThere.almostReadyActionButton"});var successToastMessageTitle=intl.formatMessage({id:"AlmostThere.successToastMessageTitle"});var successToastMessageDescription=intl.formatMessage({id:"AlmostThere.successToastMessageDescription"});var errorMessageTitle=intl.formatMessage({id:"AlmostThere.errorMessageTitle"});var errorMessageDescription=intl.formatMessage({id:"AlmostThere.errorMessageDescription"});var formRef=(0,_react.useRef)(null);var _useProfileContext=(0,_ProfileContext.useProfileContext)(),patchProfile=_useProfileContext.patchProfile,profileData=_useProfileContext.profileData,setIsPatchProfileScreenToggle=_useProfileContext.setIsPatchProfileScreenToggle,isRegisterUserProfileStep=_useProfileContext.isRegisterUserProfileStep,setIsRegisterUserProfileStepToggle=_useProfileContext.setIsRegisterUserProfileStepToggle;var _useUserDataContext=(0,_UserContext.useUserDataContext)(),isUserAuth=_useUserDataContext.isUserAuth,isConfig=_useUserDataContext.isConfig,setIsUserAuth=_useUserDataContext.setIsUserAuth,logout=_useUserDataContext.logout;var classes=(0,_styles["default"])({});var _useToast=(0,_Toast.useToast)(),addToast=_useToast.addToast;(0,_react.useEffect)(function(){setIsRegisterUserProfileStepToggle(true)},[setIsRegisterUserProfileStepToggle]);(0,_react.useEffect)(function(){setIsPatchProfileScreenToggle(true)},[setIsPatchProfileScreenToggle]);(0,_react.useEffect)(function(){if(isConfig){var isAuth=/*#__PURE__*/function(){var _ref2=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee(){return _regenerator["default"].wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsUserAuth(isUserAuth);case 1:case"end":return _context.stop();}}},_callee)}));return function isAuth(){return _ref2.apply(this,arguments)}}();isAuth()}},[isConfig,isUserAuth]);var contact=profileData.contact,acceptedMaisCVC=profileData.acceptedMaisCVC,birthdate=profileData.birthdate,name=profileData.name,cpf=profileData.cpf;(0,_react.useEffect)(function(){var _formRef$current,_formRef$current2,_formRef$current4;if(name)formRef===null||formRef===void 0?void 0:(_formRef$current=formRef.current)===null||_formRef$current===void 0?void 0:_formRef$current.setFieldValue("name",name);if(cpf)formRef===null||formRef===void 0?void 0:(_formRef$current2=formRef.current)===null||_formRef$current2===void 0?void 0:_formRef$current2.setFieldValue("cpf",cpf);if(birthdate){var _formRef$current3;var replacedBirthdate=birthdate.replaceAll("-","/");var invertedBirthdate=replacedBirthdate.split("/").reverse().join("/");formRef===null||formRef===void 0?void 0:(_formRef$current3=formRef.current)===null||_formRef$current3===void 0?void 0:_formRef$current3.setFieldValue("birthdate",invertedBirthdate)}if(contact&&contact.phones&&contact.phones.length>0)formRef===null||formRef===void 0?void 0:(_formRef$current4=formRef.current)===null||_formRef$current4===void 0?void 0:_formRef$current4.setFieldValue("phone",contact.phones[0].phoneNumber)},[birthdate,contact,cpf,name]);var submitForm=(0,_react.useCallback)(/*#__PURE__*/function(){var _ref3=(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee3(formData){var _formRef$current5,schema,replacedBirthdate,invertedBirthdate,formmatedBirthdate,postData,_formRef$current6;return _regenerator["default"].wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;(_formRef$current5=formRef.current)===null||_formRef$current5===void 0?void 0:_formRef$current5.setErrors({});schema=Yup.object().shape({name:Yup.string().required(errorNameIsRequired),cpf:Yup.string().min(14,errorInvalidFormmat).required(errorCpfIsRequired),birthdate:Yup.string().min(10,errorInvalidFormmat).required(errorBirthdateIsRequired),phone:Yup.string().required(errorPhoneIsRequired)});_context3.next=5;return schema.validate(formData,{abortEarly:false});case 5:replacedBirthdate=formData.birthdate.replaceAll("/","-");invertedBirthdate=replacedBirthdate.split("-").reverse().join("-");formmatedBirthdate=invertedBirthdate;postData={name:formData.name,birthdate:formmatedBirthdate,contact:{emails:[],phones:[{type:"PERSONAL",phoneNumber:formData.phone}]},cpf:formData.cpf,acceptedMaisCVC:formData.acceptedMaisCVC};_context3.next=11;return patchProfile(postData);case 11:setIsUserAuth(true);addToast({type:"success",title:successToastMessageTitle,description:successToastMessageDescription});if(isModal){setTimeout(/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee2(){return _regenerator["default"].wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(onCloseClick){onCloseClick()}case 1:case"end":return _context2.stop();}}},_callee2)})),3000)}else{window.location.href=(0,_Redirect["default"])()}_context3.next=20;break;case 16:_context3.prev=16;_context3.t0=_context3["catch"](0);addToast({type:"error",title:errorMessageTitle,description:errorMessageDescription});if(_context3.t0 instanceof Yup.ValidationError){(_formRef$current6=formRef.current)===null||_formRef$current6===void 0?void 0:_formRef$current6.setErrors((0,_getValidationErrors["default"])(_context3.t0))}case 20:case"end":return _context3.stop();}}},_callee3,null,[[0,16]])}));return function(_x){return _ref3.apply(this,arguments)}}(),[addToast,isModal,onCloseClick,patchProfile,setIsUserAuth]);return/*#__PURE__*/_react["default"].createElement(_react["default"].Fragment,null,/*#__PURE__*/_react["default"].createElement(_HeaderLogin["default"],{isModal:isModal,previousStep:"MainScreen",onCloseClick:/*#__PURE__*/(0,_asyncToGenerator2["default"])(/*#__PURE__*/_regenerator["default"].mark(function _callee4(){return _regenerator["default"].wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!onCloseClick){_context4.next=4;break}_context4.next=3;return logout({noReload:true});case 3:onCloseClick();case 4:case"end":return _context4.stop();}}},_callee4)}))}),/*#__PURE__*/_react["default"].createElement("div",{className:classes.root},/*#__PURE__*/_react["default"].createElement(_Form["default"],{ref:formRef,handleSubmit:submitForm},/*#__PURE__*/_react["default"].createElement(_Title["default"],null,isRegisterUserProfileStep?almostReadyTitle:almostThereTitle),/*#__PURE__*/_react["default"].createElement(_SubTitle["default"],{className:classes.subTitle},isRegisterUserProfileStep?almostReadySubTitle:almostThereSubTitle),/*#__PURE__*/_react["default"].createElement("div",{className:classes.inputWrapper},/*#__PURE__*/_react["default"].createElement(_Input["default"],{name:"name",placeholderText:inputPlaceholderName,shrink:!!name})),/*#__PURE__*/_react["default"].createElement("div",{className:classes.inputWrapper},/*#__PURE__*/_react["default"].createElement(_Input["default"],{name:"cpf",placeholderText:inputPlaceholderCPF,hasMask:true,mask:!!cpf?"\\*\\*\\*.\\*\\*\\*.99\\*-9\\*":"999.999.999-99",autoComplete:"off",shrink:!!cpf,disabledInput:!!cpf,showTip:true,infoMessage:inputInfoCPF})),/*#__PURE__*/_react["default"].createElement("div",{className:classes.inputWrapper},/*#__PURE__*/_react["default"].createElement(_Input["default"],{name:"birthdate",placeholderText:inputPlaceholderBirthdate,hasMask:true,mask:"99/99/9999",shrink:!!birthdate})),/*#__PURE__*/_react["default"].createElement("div",{className:classes.inputWrapper},/*#__PURE__*/_react["default"].createElement(_Input["default"],{name:"phone",placeholderText:inputPlaceholderPhone,hasMask:true,mask:"(99) 999999999",shrink:contact&&(contact===null||contact===void 0?void 0:contact.phones)&&contact.phones.length>0})),!acceptedMaisCVC&&/*#__PURE__*/_react["default"].createElement(_Checkbox["default"],{name:"acceptedMaisCVC",value:"consent",label:/*#__PURE__*/_react["default"].createElement(_react["default"].Fragment,null,"".concat(termsAndConditionsPart1," "),/*#__PURE__*/_react["default"].createElement("a",{target:"_blank",href:"https://qa.cvc.com.br/cartao-de-credito-cvc",rel:"noreferrer"}," ","".concat(termsAndConditionsPart2," ")),"".concat(termsAndConditionsPart3," "),/*#__PURE__*/_react["default"].createElement("a",{target:"_blank",href:"https://cartaoitau.cvc.com.br/maiscvc_regulamento.pdf",rel:"noreferrer"},"".concat(termsAndConditionsPart4," ")),"".concat(termsAndConditionsPart5))}),/*#__PURE__*/_react["default"].createElement("div",{className:classes.internalButtonWrapper},/*#__PURE__*/_react["default"].createElement(_InternalButton["default"],{type:"submit",text:isRegisterUserProfileStep?almostReadyActionButton:almostThereActionButton})))))};var _default=(0,_reactIntl.injectIntl)(AlmostThere);exports["default"]=_default;
//# sourceMappingURL=index.js.map