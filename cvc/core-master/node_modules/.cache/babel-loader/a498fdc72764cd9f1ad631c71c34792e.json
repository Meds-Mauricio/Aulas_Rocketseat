{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\felip\\\\OneDrive\\\\Dokumente\\\\cvc\\\\core-master\\\\src\\\\MyTravelLogin\\\\UserAccessSteps\\\\ValidationCode\\\\index.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\n/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport React, { useMemo, useRef, useContext, useEffect, useState } from \"react\";\nimport Link from \"@material-ui/core/Link\";\nimport { Auth } from \"aws-amplify\";\nimport { injectIntl } from \"react-intl\";\nimport * as Yup from \"yup\";\nimport { BrandContext } from \"../../../BrandContext\";\nimport { Redirect } from \"../../../BrandContext/amplify/aws.config\";\nimport { useProfileContext } from \"../../../ProfileContext\";\nimport { useUserDataContext } from \"../../../UserContext\";\nimport { featureToggles, getParam } from \"../../../utils\";\nimport useGa from \"../../../utils/useGa\";\nimport { useAuthAmplifyContext } from \"../../contexts/AmplifyContext\";\nimport { useLoadingContext } from \"../../contexts/LoadingContext\";\nimport { useRenderSteps } from \"../../contexts/renderSteps\";\nimport { useToast } from \"../../contexts/Toast\";\nimport Form from \"../../shared/components/Form\";\nimport HeaderLogin from \"../../shared/components/HeaderLogin\";\nimport Input from \"../../shared/components/Input\";\nimport InternalButton from \"../../shared/components/InternalButton\";\nimport Loading from \"../../shared/components/Loading\";\nimport SubTitle from \"../../shared/components/SubTitle\";\nimport Terms from \"../../shared/components/Terms\";\nimport Title from \"../../shared/components/Title\";\nimport { useUserData } from \"../../shared/hooks/UserContext\";\nimport translate from \"../../shared/i18n/translate\";\nimport getValidationErrors from \"../../shared/utils/getValidationErrors\";\nimport useStyles from \"./styles\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar ValidationCode = function ValidationCode(_ref) {\n  _s();\n\n  var intl = _ref.intl,\n      onCloseClick = _ref.onCloseClick,\n      isModal = _ref.isModal;\n  var classes = useStyles({});\n\n  var _useRenderSteps = useRenderSteps(),\n      renderNewStep = _useRenderSteps.renderNewStep,\n      setPreviousStep = _useRenderSteps.setPreviousStep;\n\n  var _useAuthAmplifyContex = useAuthAmplifyContext(),\n      authAmplify = _useAuthAmplifyContex.authAmplify,\n      amplifyTempPwd = _useAuthAmplifyContex.amplifyTempPwd,\n      amplifyPwd = _useAuthAmplifyContex.amplifyPwd;\n\n  var _useUserData = useUserData(),\n      user = _useUserData.user;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      hasDoneProfileReq = _useState2[0],\n      setHasDoneProfileReq = _useState2[1];\n\n  var ctx = useContext(BrandContext);\n  var formRef = useRef(null);\n\n  var _useLoadingContext = useLoadingContext(),\n      setLoading = _useLoadingContext.setLoading,\n      loading = _useLoadingContext.loading;\n\n  var _useToast = useToast(),\n      addToast = _useToast.addToast;\n\n  var _useUserDataContext = useUserDataContext(),\n      setUserIdToken = _useUserDataContext.setUserIdToken;\n\n  var _useProfileContext = useProfileContext(),\n      profileData = _useProfileContext.profileData,\n      getProfileInformations = _useProfileContext.getProfileInformations;\n\n  var errorWarningExpiredCodeTitle = intl.formatMessage({\n    id: \"ValidationCode.errorWarningExpiredCodeTitle\"\n  });\n  var errorWarningExpiredCodeDescription = intl.formatMessage({\n    id: \"ValidationCode.errorWarningExpiredCodeDescription\"\n  });\n  var errorWarningNetworkErrorTitle = intl.formatMessage({\n    id: \"ValidationCode.errorWarningNetworkErrorTitle\"\n  });\n  var errorWarningNetworkErrorDescription = intl.formatMessage({\n    id: \"ValidationCode.errorWarningNetworkErrorDescription\"\n  });\n  var toastDefaultErrorMessageTitle = intl.formatMessage({\n    id: \"ValidationCode.toastDefaultErrorMessageTitle\"\n  });\n  var toastDefaultErrorMessageDescription = intl.formatMessage({\n    id: \"ValidationCode.toastDefaultErrorMessageDescription\"\n  });\n\n  var _useGa = useGa(),\n      saveOnGa = _useGa.saveOnGa;\n\n  var name = profileData.name,\n      birthdate = profileData.birthdate,\n      contact = profileData.contact,\n      cpf = profileData.cpf;\n  var requiredProfileInformations = useMemo(function () {\n    return !!name && !!birthdate && !!contact && !!cpf;\n  }, [birthdate, contact, cpf, name]);\n  useEffect(function () {\n    if (hasDoneProfileReq) {\n      setHasDoneProfileReq(false);\n      getProfileInformations();\n\n      if (!requiredProfileInformations) {\n        renderNewStep(\"AlmostThere\");\n      } else if (isModal) {\n        if (onCloseClick) {\n          onCloseClick();\n        }\n      } else {\n        if (getParam(\"path\")) {\n          window.location.href = \"\".concat(Redirect(ctx.hosts)).concat(getParam(\"path\"));\n          return;\n        }\n\n        window.location.href = \"\".concat(Redirect(ctx.hosts), \"/mytravels/reservations\");\n      }\n\n      setLoading(false);\n    }\n  }, [hasDoneProfileReq]);\n\n  var handleSubmit = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(data) {\n      var _formRef$current2, _formRef$current3;\n\n      var _formRef$current, schema, code, _siginRes$pool, siginRes, storagedData, i, key, _formRef$current4;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setPreviousStep(\"ValidationCode\");\n              _context.prev = 1;\n              saveOnGa({\n                event: \"login_event\",\n                category: \"Account\",\n                action: \"Validation code\",\n                label: \"validade code\"\n              });\n              (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.setErrors({});\n              schema = Yup.object().shape({\n                code: Yup.string().required(intl.formatMessage({\n                  id: \"ValidationCode.errorMessage\"\n                }))\n              });\n              _context.next = 7;\n              return schema.validate(data, {\n                abortEarly: false\n              });\n\n            case 7:\n              code = data.code;\n              setLoading(true);\n              _context.prev = 9;\n\n              if (!(authAmplify === \"confirmSignUp\")) {\n                _context.next = 37;\n                break;\n              }\n\n              _context.next = 13;\n              return Auth.confirmSignUp(user.email, code);\n\n            case 13:\n              saveOnGa({\n                event: \"login_event\",\n                category: \"Account\",\n                action: \"Registration\",\n                label: \"registeredUser ok\"\n              });\n\n              if (amplifyPwd) {\n                _context.next = 18;\n                break;\n              }\n\n              renderNewStep(\"Password\");\n              _context.next = 35;\n              break;\n\n            case 18:\n              _context.next = 20;\n              return Auth.signIn(user.email, amplifyPwd);\n\n            case 20:\n              siginRes = _context.sent;\n              storagedData = siginRes === null || siginRes === void 0 ? void 0 : (_siginRes$pool = siginRes.pool) === null || _siginRes$pool === void 0 ? void 0 : _siginRes$pool.storage;\n\n              for (i = 0; i < storagedData.length; i += 1) {\n                key = storagedData.key(i);\n\n                if (key.startsWith(\"CognitoIdentityServiceProvider\") && key.endsWith(\"idToken\")) {\n                  setUserIdToken(storagedData.getItem(key));\n                }\n              }\n\n              if (!featureToggles(ctx, \"PROFILE\")) {\n                _context.next = 27;\n                break;\n              }\n\n              setHasDoneProfileReq(true);\n              _context.next = 35;\n              break;\n\n            case 27:\n              if (!isModal) {\n                _context.next = 31;\n                break;\n              }\n\n              if (onCloseClick) {\n                onCloseClick();\n              }\n\n              _context.next = 35;\n              break;\n\n            case 31:\n              if (!getParam(\"path\")) {\n                _context.next = 34;\n                break;\n              }\n\n              window.location.href = \"\".concat(Redirect(ctx.hosts)).concat(getParam(\"path\"));\n              return _context.abrupt(\"return\");\n\n            case 34:\n              window.location.href = \"\".concat(Redirect(ctx.hosts), \"/mytravels/reservations\");\n\n            case 35:\n              _context.next = 40;\n              break;\n\n            case 37:\n              _context.next = 39;\n              return Auth.forgotPasswordSubmit(user.email, code, amplifyTempPwd);\n\n            case 39:\n              renderNewStep(\"ChangePassword\");\n\n            case 40:\n              saveOnGa({\n                event: \"login_event\",\n                category: \"Account\",\n                action: \"Validation code\",\n                label: \"validateCode ok\"\n              });\n              _context.next = 57;\n              break;\n\n            case 43:\n              _context.prev = 43;\n              _context.t0 = _context[\"catch\"](9);\n              _context.t1 = _context.t0.code;\n              _context.next = _context.t1 === \"InvalidParameterException\" ? 48 : _context.t1 === \"NetworkError\" ? 51 : _context.t1 === \"CodeMismatchException\" ? 53 : 55;\n              break;\n\n            case 48:\n              (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.setErrors({\n                code: errorWarningExpiredCodeTitle\n              });\n              addToast({\n                type: \"error\",\n                title: errorWarningExpiredCodeTitle,\n                description: errorWarningExpiredCodeDescription\n              });\n              return _context.abrupt(\"break\", 57);\n\n            case 51:\n              addToast({\n                type: \"error\",\n                title: errorWarningNetworkErrorTitle,\n                description: errorWarningNetworkErrorDescription\n              });\n              return _context.abrupt(\"break\", 57);\n\n            case 53:\n              (_formRef$current3 = formRef.current) === null || _formRef$current3 === void 0 ? void 0 : _formRef$current3.setErrors({\n                code: \"Código inválido.\"\n              });\n              return _context.abrupt(\"break\", 57);\n\n            case 55:\n              addToast({\n                type: \"error\",\n                title: toastDefaultErrorMessageTitle,\n                description: toastDefaultErrorMessageDescription\n              });\n              return _context.abrupt(\"break\", 57);\n\n            case 57:\n              setLoading(false);\n              _context.next = 63;\n              break;\n\n            case 60:\n              _context.prev = 60;\n              _context.t2 = _context[\"catch\"](1);\n\n              if (_context.t2 instanceof Yup.ValidationError) {\n                (_formRef$current4 = formRef.current) === null || _formRef$current4 === void 0 ? void 0 : _formRef$current4.setErrors(getValidationErrors(_context.t2));\n              }\n\n            case 63:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[1, 60], [9, 43]]);\n    }));\n\n    return function handleSubmit(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleCodeNonReceived = function handleCodeNonReceived() {\n    saveOnGa({\n      event: \"login_event\",\n      category: \"Account\",\n      action: \"Validation code\",\n      label: \"action :: non receipt recovery code\"\n    });\n    renderNewStep(\"CodeNonReceived\");\n  };\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 16\n    }, _this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(HeaderLogin, {\n      isModal: isModal,\n      previousStep: \"MainScreen\" //  onCloseClick={onCloseClick}\n\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 216,\n      columnNumber: 9\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.root,\n      children: [/*#__PURE__*/_jsxDEV(Title, {\n        className: classes.title,\n        children: translate({\n          id: \"ValidationCode.title\"\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 220,\n        columnNumber: 13\n      }, _this), /*#__PURE__*/_jsxDEV(SubTitle, {\n        className: classes.subTitle,\n        children: translate({\n          id: \"ValidationCode.subTitle\",\n          value: {\n            email: /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: user ? user.email : \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 227,\n              columnNumber: 32\n            }, _this)\n          }\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 13\n      }, _this), /*#__PURE__*/_jsxDEV(Form, {\n        ref: formRef,\n        handleSubmit: handleSubmit,\n        children: [/*#__PURE__*/_jsxDEV(Input, {\n          type: \"text\",\n          name: \"code\",\n          placeholderText: translate({\n            id: \"ValidationCode.typeCodeText\"\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 234,\n          columnNumber: 17\n        }, _this), /*#__PURE__*/_jsxDEV(InternalButton, {\n          type: \"submit\",\n          text: intl.formatMessage({\n            id: \"ValidationCode.actionButton\"\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 17\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 13\n      }, _this), /*#__PURE__*/_jsxDEV(Link, {\n        style: {\n          textAlign: \"center\"\n        },\n        className: classes.link,\n        onMouseDown: handleCodeNonReceived,\n        children: /*#__PURE__*/_jsxDEV(SubTitle, {\n          variant: \"caption\",\n          children: /*#__PURE__*/_jsxDEV(\"b\", {\n            children: translate({\n              id: \"ValidationCode.linkNoCodeReceived\"\n            })\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 240,\n            columnNumber: 21\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 239,\n          columnNumber: 17\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 238,\n        columnNumber: 13\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 9\n    }, _this), /*#__PURE__*/_jsxDEV(Terms, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 9\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(ValidationCode, \"ETy1d3X/u2RiJvrI4QXWWP1Xmq8=\", false, function () {\n  return [useStyles, useRenderSteps, useAuthAmplifyContext, useUserData, useLoadingContext, useToast, useUserDataContext, useProfileContext, useGa];\n});\n\n_c = ValidationCode;\nexport default _c2 = injectIntl(ValidationCode);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"ValidationCode\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["C:/Users/felip/OneDrive/Dokumente/cvc/core-master/src/MyTravelLogin/UserAccessSteps/ValidationCode/index.tsx"],"names":["React","useMemo","useRef","useContext","useEffect","useState","Link","Auth","injectIntl","Yup","BrandContext","Redirect","useProfileContext","useUserDataContext","featureToggles","getParam","useGa","useAuthAmplifyContext","useLoadingContext","useRenderSteps","useToast","Form","HeaderLogin","Input","InternalButton","Loading","SubTitle","Terms","Title","useUserData","translate","getValidationErrors","useStyles","ValidationCode","intl","onCloseClick","isModal","classes","renderNewStep","setPreviousStep","authAmplify","amplifyTempPwd","amplifyPwd","user","hasDoneProfileReq","setHasDoneProfileReq","ctx","formRef","setLoading","loading","addToast","setUserIdToken","profileData","getProfileInformations","errorWarningExpiredCodeTitle","formatMessage","id","errorWarningExpiredCodeDescription","errorWarningNetworkErrorTitle","errorWarningNetworkErrorDescription","toastDefaultErrorMessageTitle","toastDefaultErrorMessageDescription","saveOnGa","name","birthdate","contact","cpf","requiredProfileInformations","window","location","href","hosts","handleSubmit","data","event","category","action","label","current","setErrors","schema","object","shape","code","string","required","validate","abortEarly","confirmSignUp","email","signIn","siginRes","storagedData","pool","storage","i","length","key","startsWith","endsWith","getItem","forgotPasswordSubmit","type","title","description","ValidationError","handleCodeNonReceived","root","subTitle","value","textAlign","link"],"mappings":"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","sourcesContent":["/* eslint-disable @typescript-eslint/ban-ts-comment */\nimport React, { useMemo, useRef, useContext, useEffect, useState } from \"react\";\nimport Link from \"@material-ui/core/Link\";\nimport { FormHandles } from \"@unform/core\";\nimport { Auth } from \"aws-amplify\";\nimport { IntlShape, injectIntl } from \"react-intl\";\nimport * as Yup from \"yup\";\nimport { BrandContext } from \"../../../BrandContext\";\nimport { Redirect } from \"../../../BrandContext/amplify/aws.config\"\nimport { useProfileContext } from \"../../../ProfileContext\";\nimport { useUserDataContext } from \"../../../UserContext\";\nimport { featureToggles, getParam } from \"../../../utils\";\nimport useGa from \"../../../utils/useGa\";\nimport { useAuthAmplifyContext } from \"../../contexts/AmplifyContext\";\nimport { useLoadingContext } from \"../../contexts/LoadingContext\";\nimport { useRenderSteps } from \"../../contexts/renderSteps\";\nimport { useToast } from \"../../contexts/Toast\";\nimport Form from \"../../shared/components/Form\";\nimport HeaderLogin from \"../../shared/components/HeaderLogin\";\nimport Input from \"../../shared/components/Input\";\nimport InternalButton from \"../../shared/components/InternalButton\";\nimport Loading from \"../../shared/components/Loading\";\nimport SubTitle from \"../../shared/components/SubTitle\";\nimport Terms from \"../../shared/components/Terms\";\nimport Title from \"../../shared/components/Title\";\nimport { useUserData } from \"../../shared/hooks/UserContext\";\nimport translate from \"../../shared/i18n/translate\";\nimport getValidationErrors from \"../../shared/utils/getValidationErrors\";\nimport useStyles from \"./styles\";\n\ninterface ValidationCodeProps {\n    code: string;\n}\ninterface TValidationCode {\n    intl: IntlShape;\n    onCloseClick?(): void;\n    isModal?: boolean;\n}\n\nconst ValidationCode: React.FC<TValidationCode> = ({ intl, onCloseClick, isModal }) => {\n    const classes = useStyles({});\n    const { renderNewStep, setPreviousStep } = useRenderSteps();\n    const { authAmplify, amplifyTempPwd, amplifyPwd } = useAuthAmplifyContext();\n    const { user } = useUserData();\n    const [hasDoneProfileReq , setHasDoneProfileReq] = useState(false)\n    const ctx = useContext(BrandContext);\n    const formRef = useRef<FormHandles>(null);\n    const { setLoading, loading } = useLoadingContext();\n    const { addToast } = useToast();\n    const { setUserIdToken } = useUserDataContext();\n\n    const { profileData, getProfileInformations } = useProfileContext()\n\n    const errorWarningExpiredCodeTitle = intl.formatMessage({ id: \"ValidationCode.errorWarningExpiredCodeTitle\" });\n    const errorWarningExpiredCodeDescription = intl.formatMessage({ id: \"ValidationCode.errorWarningExpiredCodeDescription\" });\n\n    const errorWarningNetworkErrorTitle = intl.formatMessage({ id: \"ValidationCode.errorWarningNetworkErrorTitle\" });\n    const errorWarningNetworkErrorDescription = intl.formatMessage({ id: \"ValidationCode.errorWarningNetworkErrorDescription\" });\n\n    const toastDefaultErrorMessageTitle = intl.formatMessage({ id: \"ValidationCode.toastDefaultErrorMessageTitle\" });\n    const toastDefaultErrorMessageDescription = intl.formatMessage({ id: \"ValidationCode.toastDefaultErrorMessageDescription\" });\n    const { saveOnGa } = useGa();\n\n    const { name, birthdate, contact, cpf } = profileData\n\n    const requiredProfileInformations = useMemo(() => {\n        return !!name && !!birthdate && !!contact && !!cpf\n    }, [birthdate, contact, cpf, name])\n\n    useEffect(() => {\n        if(hasDoneProfileReq){\n            setHasDoneProfileReq(false)\n            getProfileInformations()\n\n            if(!requiredProfileInformations) {\n                renderNewStep(\"AlmostThere\");\n            }else if (isModal) {\n                if (onCloseClick) {\n                    onCloseClick();\n                }\n            } else {\n                if (getParam(\"path\")) {\n                    window.location.href = `${Redirect(ctx.hosts)}${getParam(\"path\")}`\n                    return\n                }\n                window.location.href = `${Redirect(ctx.hosts)}/mytravels/reservations`;\n            }\n\n            setLoading(false);\n        }\n    }, [hasDoneProfileReq])\n\n    const handleSubmit = async (data: ValidationCodeProps): Promise<void> => {\n        setPreviousStep(\"ValidationCode\");\n        try {\n            saveOnGa({\n                event: \"login_event\",\n                category: \"Account\",\n                action: \"Validation code\",\n                label: \"validade code\"\n            });\n            formRef.current?.setErrors({});\n            const schema = Yup.object().shape({\n                code: Yup.string().required(intl.formatMessage({ id: \"ValidationCode.errorMessage\" }))\n            });\n\n            await schema.validate(data, {\n                abortEarly: false\n            });\n            const { code } = data;\n            setLoading(true);\n            try {\n                if (authAmplify === \"confirmSignUp\") {\n                    await Auth.confirmSignUp(user.email, code);\n                    saveOnGa({\n                        event: \"login_event\",\n                        category: \"Account\",\n                        action: \"Registration\",\n                        label: \"registeredUser ok\"\n                    });\n                    if (!amplifyPwd) {\n                        renderNewStep(\"Password\");\n                    } else {\n                        const siginRes =  await Auth.signIn(user.email, amplifyPwd);\n                        const storagedData = siginRes?.pool?.storage\n\n                        for (let i = 0; i < storagedData.length; i += 1) {\n                            const key = storagedData.key(i)\n                            if (key.startsWith(\"CognitoIdentityServiceProvider\") && key.endsWith(\"idToken\")) {\n                                setUserIdToken(storagedData.getItem(key));\n                            }\n                        }\n                        if(featureToggles(ctx, \"PROFILE\")){\n                            setHasDoneProfileReq(true)\n\n                        } else if (isModal) {\n                            if (onCloseClick) {\n                                onCloseClick();\n                            }\n                        } else {\n                            if (getParam(\"path\")) {\n                                window.location.href = `${Redirect(ctx.hosts)}${getParam(\"path\")}`\n                                return\n                            }\n                            window.location.href = `${Redirect(ctx.hosts)}/mytravels/reservations`;\n                        }\n                    }\n                } else {\n                    await Auth.forgotPasswordSubmit(user.email, code, amplifyTempPwd);\n                    renderNewStep(\"ChangePassword\");\n                }\n                saveOnGa({\n                    event: \"login_event\",\n                    category: \"Account\",\n                    action: \"Validation code\",\n                    label: \"validateCode ok\"\n                });\n            } catch (err) {\n                //    para tratar\n                // CodeMismatchException\n                // @ts-ignore\n                switch (err.code) {\n                case \"InvalidParameterException\":\n                    formRef.current?.setErrors({ code: errorWarningExpiredCodeTitle });\n                    addToast({\n                        type: \"error\",\n                        title: errorWarningExpiredCodeTitle,\n                        description: errorWarningExpiredCodeDescription,\n                    });\n                    break;\n                case \"NetworkError\":\n                    addToast({\n                        type: \"error\",\n                        title: errorWarningNetworkErrorTitle,\n                        description: errorWarningNetworkErrorDescription,\n                    });\n                    break;\n                case \"CodeMismatchException\":\n                    formRef.current?.setErrors({ code: \"Código inválido.\" });\n                    break;\n\n                default:\n                    addToast({\n                        type: \"error\",\n                        title: toastDefaultErrorMessageTitle,\n                        description: toastDefaultErrorMessageDescription,\n                    });\n                    break;\n                }\n            }\n\n            setLoading(false);\n\n        } catch (error) {\n            if (error instanceof Yup.ValidationError) {\n                formRef.current?.setErrors(getValidationErrors(error));\n            }\n        }\n    };\n\n    const handleCodeNonReceived = () => {\n        saveOnGa({\n            event: \"login_event\",\n            category: \"Account\",\n            action: \"Validation code\",\n            label: \"action :: non receipt recovery code\"\n        });\n\n        renderNewStep(\"CodeNonReceived\");\n    };\n\n    if (loading) {\n        return <Loading />\n    }\n    return <>\n        <HeaderLogin isModal={isModal} previousStep=\"MainScreen\"\n        //  onCloseClick={onCloseClick}\n        />\n        <div className={classes.root}>\n            <Title className={classes.title}>\n                {translate({ id: \"ValidationCode.title\" })}\n            </Title>\n            <SubTitle className={classes.subTitle}>\n                {translate({\n                    id: \"ValidationCode.subTitle\",\n                    value: {\n                        email: <strong>{user ? user.email : \"\"}</strong>\n\n                    },\n                })}\n            </SubTitle>\n\n            <Form ref={formRef} handleSubmit={handleSubmit} >\n                <Input type=\"text\" name=\"code\" placeholderText={translate({ id: \"ValidationCode.typeCodeText\" })} />\n\n                <InternalButton type=\"submit\" text={intl.formatMessage({ id: \"ValidationCode.actionButton\" })} />\n            </Form>\n            <Link style={{ textAlign: \"center\" }} className={classes.link} onMouseDown={handleCodeNonReceived}>\n                <SubTitle variant=\"caption\">\n                    <b>{translate({ id: \"ValidationCode.linkNoCodeReceived\" })}</b>\n                </SubTitle>\n            </Link>\n\n        </div>\n        <Terms />\n    </>\n\n};\n\nexport default injectIntl(ValidationCode);\n"]},"metadata":{},"sourceType":"module"}