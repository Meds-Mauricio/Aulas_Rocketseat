{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _asyncToGenerator from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\felip\\\\OneDrive\\\\Dokumente\\\\cvc\\\\core-master\\\\src\\\\BrandContext\\\\BrandContextProvider.tsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$(),\n    _s3 = $RefreshSig$();\n\nimport React, { useContext, useEffect, useState } from \"react\";\nimport { Amplify } from \"aws-amplify\";\nimport { ProfileDataProvider } from \"../ProfileContext\";\nimport ThemeProviderCustom from \"../ThemeProviderCustom/ThemeProviderCustom\";\nimport { UserDataProvider } from \"../UserContext\";\nimport configAws from \"./amplify/aws.config\";\nimport { BrandContext, useFetchAllBrands } from \"./BrandContext\";\nimport api from \"./services/api\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport function getHostName(req) {\n  var isServer = Boolean(req);\n  if (!isServer && typeof window === \"undefined\") throw {\n    message: \"Você está chamando esse método em um contexto de servidor sem a requisição correspondente.\"\n  };\n  var fullUrl = isServer ? \"http://\".concat(req.headers[\"X-Forwarded-Host\"] || req.headers.host, \"/\").concat(req.url) : document.location.href;\n  var url = new URL(fullUrl);\n  var qs = url.searchParams;\n  return {\n    hostname: qs.has(\"__contextBrandUrl\") ? qs.get(\"__contextBrandUrl\") : url.hostname\n  };\n}\nexport function brandResolver(brands, hostname) {\n  if (hostname == null) hostname = getHostName().hostname;\n  var brand = brands.find(function (x) {\n    return x.hosts.includes(hostname || \"\");\n  });\n  if (brand == null) throw {\n    message: \"hostname \".concat(hostname, \" not found.\")\n  };\n  return brand;\n}\nexport function BrandContextProvider(_ref) {\n  var brand = _ref.brand,\n      brands = _ref.brands,\n      hostname = _ref.hostname,\n      children = _ref.children;\n  return /*#__PURE__*/_jsxDEV(BrandContext.Provider, {\n    value: brand !== null && brand !== void 0 ? brand : brandResolver(brands, hostname),\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 30,\n    columnNumber: 12\n  }, this);\n}\n_c = BrandContextProvider;\nexport var ClientBasedAllBrands = /*#__PURE__*/React.createContext(null);\n\nfunction AllBrandsProvider(_ref2) {\n  _s();\n\n  var contextPath = _ref2.contextPath,\n      children = _ref2.children;\n  var brands = useFetchAllBrands(contextPath);\n  return /*#__PURE__*/_jsxDEV(ClientBasedAllBrands.Provider, {\n    value: brands,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 36,\n    columnNumber: 12\n  }, this);\n}\n\n_s(AllBrandsProvider, \"aEVkVlN/xm6jynmsk7t/IJdARuQ=\", false, function () {\n  return [useFetchAllBrands];\n});\n\n_c2 = AllBrandsProvider;\nexport function InternalApp(_ref3) {\n  _s2();\n\n  var hostname = _ref3.hostname,\n      children = _ref3.children;\n  var brands = useContext(ClientBasedAllBrands);\n  if (brands == null) return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: \"Carregando...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 43,\n    columnNumber: 16\n  }, this);\n  return /*#__PURE__*/_jsxDEV(BrandContextProvider, {\n    brands: brands,\n    hostname: hostname,\n    children: /*#__PURE__*/_jsxDEV(ThemeProviderCustom, {\n      children: /*#__PURE__*/_jsxDEV(UserDataProviderCustom, {\n        children: /*#__PURE__*/_jsxDEV(ProfileDataProvider, {\n          children: children\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 49,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 48,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 47,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 46,\n    columnNumber: 9\n  }, this);\n}\n\n_s2(InternalApp, \"266r1kMm/QCdvjCCCmvpJHkLhDE=\");\n\n_c3 = InternalApp;\n\nfunction configureAmplify(_x) {\n  return _configureAmplify.apply(this, arguments);\n}\n\nfunction _configureAmplify() {\n  _configureAmplify = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(ctx) {\n    var awsAmplifyConfig, awsConfig;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return api.get(\"/apigw/authentication/\".concat(ctx.brand, \"/config\"));\n\n          case 2:\n            awsAmplifyConfig = _context2.sent;\n            awsConfig = configAws(awsAmplifyConfig.data, ctx.hosts);\n            Amplify.configure(awsConfig);\n            return _context2.abrupt(\"return\", true);\n\n          case 6:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _configureAmplify.apply(this, arguments);\n}\n\nexport function UserDataProviderCustom(_ref4) {\n  _s3();\n\n  var children = _ref4.children;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      config = _useState2[0],\n      setConfig = _useState2[1];\n\n  var ctx = useContext(BrandContext);\n  useEffect(function () {\n    function fetchConfig() {\n      return _fetchConfig.apply(this, arguments);\n    }\n\n    function _fetchConfig() {\n      _fetchConfig = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var conf;\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return configureAmplify(ctx);\n\n              case 2:\n                conf = _context.sent;\n                setConfig(conf);\n\n              case 4:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n      return _fetchConfig.apply(this, arguments);\n    }\n\n    fetchConfig();\n  }, []);\n  return /*#__PURE__*/_jsxDEV(UserDataProvider, {\n    config: config,\n    children: /*#__PURE__*/_jsxDEV(ProfileDataProvider, {\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 75,\n    columnNumber: 9\n  }, this);\n}\n\n_s3(UserDataProviderCustom, \"Oqig4uS0aaIfzUg5e2tF9R9RN1U=\");\n\n_c4 = UserDataProviderCustom;\nexport function ClientBasedApp(_ref5) {\n  var contextPath = _ref5.contextPath,\n      hostname = _ref5.hostname,\n      children = _ref5.children;\n  return /*#__PURE__*/_jsxDEV(AllBrandsProvider, {\n    contextPath: contextPath,\n    children: /*#__PURE__*/_jsxDEV(InternalApp, {\n      hostname: hostname,\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 85,\n    columnNumber: 9\n  }, this);\n}\n_c5 = ClientBasedApp;\n\nvar _c, _c2, _c3, _c4, _c5;\n\n$RefreshReg$(_c, \"BrandContextProvider\");\n$RefreshReg$(_c2, \"AllBrandsProvider\");\n$RefreshReg$(_c3, \"InternalApp\");\n$RefreshReg$(_c4, \"UserDataProviderCustom\");\n$RefreshReg$(_c5, \"ClientBasedApp\");","map":{"version":3,"sources":["C:/Users/felip/OneDrive/Dokumente/cvc/core-master/src/BrandContext/BrandContextProvider.tsx"],"names":["React","useContext","useEffect","useState","Amplify","ProfileDataProvider","ThemeProviderCustom","UserDataProvider","configAws","BrandContext","useFetchAllBrands","api","getHostName","req","isServer","Boolean","window","message","fullUrl","headers","host","url","document","location","href","URL","qs","searchParams","hostname","has","get","brandResolver","brands","brand","find","x","hosts","includes","BrandContextProvider","children","ClientBasedAllBrands","createContext","AllBrandsProvider","contextPath","InternalApp","configureAmplify","ctx","awsAmplifyConfig","awsConfig","data","configure","UserDataProviderCustom","config","setConfig","fetchConfig","conf","ClientBasedApp"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from \"react\";\nimport { Amplify } from \"aws-amplify\";\nimport { ProfileDataProvider } from \"../ProfileContext\";\nimport ThemeProviderCustom from \"../ThemeProviderCustom/ThemeProviderCustom\";\nimport { UserDataProvider, useUserDataContext } from \"../UserContext\";\nimport configAws from \"./amplify/aws.config\";\nimport { BrandContext, BrandContextType, useFetchAllBrands } from \"./BrandContext\";\nimport api from \"./services/api\";\n\nexport function getHostName(req?: any): { hostname: string } {\n    const isServer = Boolean(req);\n\n    if (!isServer && typeof window === \"undefined\")\n        throw { message: \"Você está chamando esse método em um contexto de servidor sem a requisição correspondente.\" };\n\n    const fullUrl = isServer ? `http://${req.headers[\"X-Forwarded-Host\"] || req.headers.host}/${req.url}` : document.location.href;\n    const url = new URL(fullUrl);\n    const qs = url.searchParams;\n    return { hostname: (qs.has(\"__contextBrandUrl\") ? qs.get(\"__contextBrandUrl\") : url.hostname) as string };\n}\n\nexport function brandResolver(brands: BrandContextType[], hostname: string): BrandContextType {\n    if (hostname == null) hostname = getHostName().hostname;\n\n    const brand = brands.find(x => x.hosts.includes(hostname || \"\"));\n    if (brand == null) throw { message: `hostname ${hostname} not found.` };\n    return brand;\n}\nexport function BrandContextProvider({ brand, brands, hostname, children }: { brand?: BrandContextType, brands?: BrandContextType[], hostname: string, children: JSX.Element }) {\n    return <BrandContext.Provider value={brand ?? brandResolver(brands!, hostname)}>{children}</BrandContext.Provider>;\n}\n\nexport const ClientBasedAllBrands = React.createContext(null);\nfunction AllBrandsProvider({ contextPath, children }) {\n    const brands = useFetchAllBrands(contextPath);\n    return <ClientBasedAllBrands.Provider value={brands}>{children}</ClientBasedAllBrands.Provider>;\n}\n\nexport function InternalApp({ hostname, children }) {\n    const brands = useContext(ClientBasedAllBrands);\n\n    if (brands == null)\n        return <div>Carregando...</div>;\n\n    return (\n        <BrandContextProvider brands={brands} hostname={hostname}>\n            <ThemeProviderCustom>\n                <UserDataProviderCustom>\n                    <ProfileDataProvider>\n                        {children}\n                    </ProfileDataProvider>\n                </UserDataProviderCustom>\n            </ThemeProviderCustom>\n        </BrandContextProvider>\n    );\n}\nasync function configureAmplify(ctx) {\n    const awsAmplifyConfig = await api.get(`/apigw/authentication/${ctx.brand}/config`);\n    const awsConfig = configAws(awsAmplifyConfig.data, ctx.hosts);\n    Amplify.configure(awsConfig);\n    return true\n}\n\nexport function UserDataProviderCustom({ children }) {\n    const [config, setConfig] = useState(false)\n    const ctx = useContext(BrandContext);\n    useEffect(() => {\n        async function fetchConfig() {\n            const conf = await configureAmplify(ctx);\n            setConfig(conf)\n        }\n        fetchConfig();\n    }, [])\n    return (\n        <UserDataProvider config={config} >\n            <ProfileDataProvider>\n                {children}\n            </ProfileDataProvider>\n        </UserDataProvider>\n\n    )\n}\nexport function ClientBasedApp({ contextPath, hostname, children }) {\n    return (\n        <AllBrandsProvider contextPath={contextPath}>\n            <InternalApp hostname={hostname}>\n                {children}\n            </InternalApp>\n        </AllBrandsProvider>\n    );\n}\n"]},"metadata":{},"sourceType":"module"}