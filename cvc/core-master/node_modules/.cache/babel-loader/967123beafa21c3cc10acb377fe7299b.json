{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\felip\\\\OneDrive\\\\Dokumente\\\\cvc\\\\core-master\\\\src\\\\MyTravelLogin\\\\UserAccessSteps\\\\MainScreen\\\\index.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { useRef, useContext, useCallback, useEffect } from \"react\";\nimport { Typography } from \"@material-ui/core\";\nimport { injectIntl } from \"react-intl\";\nimport * as Yup from \"yup\";\nimport { BrandContext } from \"../../../BrandContext\";\nimport { useProfileContext } from \"../../../ProfileContext\";\nimport useCognitoIdTokenUpdate from \"../../../UserArea/CognitoIdTokenUpdate\";\nimport useGa from \"../../../utils/useGa\";\nimport { useAuthAmplifyContext } from \"../../contexts/AmplifyContext\";\nimport { useLoadingContext } from \"../../contexts/LoadingContext\";\nimport { useRenderSteps } from \"../../contexts/renderSteps\";\nimport { useToast } from \"../../contexts/Toast\";\nimport BtnsSocialLogin from \"../../shared/components/BtnsSocialLogin\";\nimport Form from \"../../shared/components/Form\";\nimport HeaderLogin from \"../../shared/components/HeaderLogin\";\nimport Input from \"../../shared/components/Input\";\nimport InternalButton from \"../../shared/components/InternalButton\";\nimport Loading from \"../../shared/components/Loading\";\nimport SubTitle from \"../../shared/components/SubTitle\";\nimport Terms from \"../../shared/components/Terms\";\nimport Title from \"../../shared/components/Title\";\nimport { useUserData } from \"../../shared/hooks/UserContext\";\nimport translate from \"../../shared/i18n/translate\";\nimport api from \"../../shared/services/api\";\nimport getValidationErrors from \"../../shared/utils/getValidationErrors\";\nimport useStyles from \"./styles\";\nimport { usersInProvider } from \"./utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nvar MainScreen = function MainScreen(_ref) {\n  _s();\n\n  var intl = _ref.intl,\n      onCloseClick = _ref.onCloseClick,\n      isModal = _ref.isModal;\n  var placeHolderEmail = translate({\n    id: \"MainScreen.placeholderEmail\"\n  });\n  var placeHolderErrorEmail = intl.formatMessage({\n    id: \"MainScreen.placeHolderErrorEmail\"\n  });\n  var placeHolderEmailRequired = intl.formatMessage({\n    id: \"MainScreen.placeHolderEmailRequired\"\n  });\n  var errorWarningTitle = intl.formatMessage({\n    id: \"MainScreen.errorWarningTitle\"\n  });\n  var errorWarningDescription = intl.formatMessage({\n    id: \"MainScreen.errorWarningDescription\"\n  });\n  var formRef = useRef(null);\n\n  var _useGa = useGa(),\n      saveOnGa = _useGa.saveOnGa;\n\n  var _useRenderSteps = useRenderSteps(),\n      renderNewStep = _useRenderSteps.renderNewStep,\n      setPreviousStep = _useRenderSteps.setPreviousStep;\n\n  var _useAuthAmplifyContex = useAuthAmplifyContext(),\n      setAuthAmplify = _useAuthAmplifyContex.setAuthAmplify;\n\n  var _useUserData = useUserData(),\n      setUser = _useUserData.setUser;\n\n  var _useLoadingContext = useLoadingContext(),\n      setLoading = _useLoadingContext.setLoading,\n      loading = _useLoadingContext.loading;\n\n  var ctx = useContext(BrandContext);\n\n  var _useToast = useToast(),\n      addToast = _useToast.addToast;\n\n  var classes = useStyles({});\n\n  var _useCognitoIdTokenUpd = useCognitoIdTokenUpdate(),\n      deleteCognitoServiceProvider = _useCognitoIdTokenUpd.deleteCognitoServiceProvider;\n\n  var _useProfileContext = useProfileContext(),\n      setProfileData = _useProfileContext.setProfileData;\n\n  useEffect(function () {\n    deleteCognitoServiceProvider();\n    setProfileData({});\n  }, []);\n  var submitForm = useCallback( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(formData) {\n      var _formRef$current, schema, response, email, user, _formRef$current2;\n\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              (_formRef$current = formRef.current) === null || _formRef$current === void 0 ? void 0 : _formRef$current.setErrors({});\n              schema = Yup.object().shape({\n                email: Yup.string().email(placeHolderErrorEmail).required(placeHolderEmailRequired)\n              });\n              _context.next = 5;\n              return schema.validate(formData, {\n                abortEarly: false\n              });\n\n            case 5:\n              saveOnGa({\n                event: \"login_event\",\n                category: \"Account\",\n                action: \"Form Login\",\n                label: \"login :: email\"\n              });\n              setUser(formData);\n              setLoading(true);\n              _context.prev = 8;\n              email = encodeURIComponent(formData.email);\n              _context.next = 12;\n              return api.get(\"/apigw/authentication/\".concat(ctx.brand, \"/user-exists?email=\").concat(email));\n\n            case 12:\n              response = _context.sent;\n              user = usersInProvider(response.data.found);\n              setPreviousStep(\"MainScreen\");\n\n              if (user === null || user === void 0 ? void 0 : user.nextStep) {\n                if (!user.emailConfirmed) {\n                  setAuthAmplify(\"confirmSignUp\");\n                }\n\n                renderNewStep(user.nextStep);\n              } else {\n                renderNewStep(\"ConfirmMainScreen\");\n              }\n\n              _context.next = 22;\n              break;\n\n            case 18:\n              _context.prev = 18;\n              _context.t0 = _context[\"catch\"](8);\n              saveOnGa({\n                event: \"fluxo_de_cadastro\",\n                category: \"Account\",\n                action: \"Registration\",\n                label: \"alert :: email validation\"\n              });\n              addToast({\n                type: \"error\",\n                title: errorWarningTitle,\n                description: errorWarningDescription\n              });\n\n            case 22:\n              setLoading(false);\n              _context.next = 28;\n              break;\n\n            case 25:\n              _context.prev = 25;\n              _context.t1 = _context[\"catch\"](0);\n\n              if (_context.t1 instanceof Yup.ValidationError) {\n                (_formRef$current2 = formRef.current) === null || _formRef$current2 === void 0 ? void 0 : _formRef$current2.setErrors(getValidationErrors(_context.t1));\n              }\n\n            case 28:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 25], [8, 18]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [addToast, ctx.brand, errorWarningDescription, errorWarningTitle, placeHolderEmailRequired, placeHolderErrorEmail, renderNewStep, setAuthAmplify, setLoading, setUser]);\n  return loading ? /*#__PURE__*/_jsxDEV(Loading, {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 135,\n    columnNumber: 9\n  }, _this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(HeaderLogin, {\n      isModal: isModal,\n      previousStep: \"MainScreen\",\n      onCloseClick: onCloseClick\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 13\n    }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.root,\n      children: /*#__PURE__*/_jsxDEV(Form, {\n        ref: formRef,\n        handleSubmit: submitForm,\n        children: [/*#__PURE__*/_jsxDEV(Title, {\n          children: translate({\n            id: \"MainScreen.title\"\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 141,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(SubTitle, {\n          children: translate({\n            id: \"MainScreen.subtitle\"\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 142,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.inputWrapper,\n          children: /*#__PURE__*/_jsxDEV(Input, {\n            name: \"email\",\n            placeholderText: placeHolderEmail\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 144,\n            columnNumber: 25\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 143,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(InternalButton, {\n          type: \"submit\",\n          text: translate({\n            id: \"MainScreen.btnLogin\"\n          })\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: classes.orSeparateWrapper,\n          children: /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"caption\",\n            className: classes.orSeparate,\n            children: \"ou\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 150,\n            columnNumber: 25\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 21\n        }, _this), /*#__PURE__*/_jsxDEV(BtnsSocialLogin, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 154,\n          columnNumber: 21\n        }, _this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 17\n      }, _this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 139,\n      columnNumber: 13\n    }, _this), /*#__PURE__*/_jsxDEV(Terms, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 13\n    }, _this)]\n  }, void 0, true);\n};\n\n_s(MainScreen, \"HZX9g8O70g6xygqJxXRD+cOmkE8=\", false, function () {\n  return [useGa, useRenderSteps, useAuthAmplifyContext, useUserData, useLoadingContext, useToast, useStyles, useCognitoIdTokenUpdate, useProfileContext];\n});\n\n_c = MainScreen;\nexport default _c2 = injectIntl(MainScreen);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"MainScreen\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["C:/Users/felip/OneDrive/Dokumente/cvc/core-master/src/MyTravelLogin/UserAccessSteps/MainScreen/index.tsx"],"names":["React","useRef","useContext","useCallback","useEffect","Typography","injectIntl","Yup","BrandContext","useProfileContext","useCognitoIdTokenUpdate","useGa","useAuthAmplifyContext","useLoadingContext","useRenderSteps","useToast","BtnsSocialLogin","Form","HeaderLogin","Input","InternalButton","Loading","SubTitle","Terms","Title","useUserData","translate","api","getValidationErrors","useStyles","usersInProvider","MainScreen","intl","onCloseClick","isModal","placeHolderEmail","id","placeHolderErrorEmail","formatMessage","placeHolderEmailRequired","errorWarningTitle","errorWarningDescription","formRef","saveOnGa","renderNewStep","setPreviousStep","setAuthAmplify","setUser","setLoading","loading","ctx","addToast","classes","deleteCognitoServiceProvider","setProfileData","submitForm","formData","current","setErrors","schema","object","shape","email","string","required","validate","abortEarly","event","category","action","label","encodeURIComponent","get","brand","response","user","data","found","nextStep","emailConfirmed","type","title","description","ValidationError","root","inputWrapper","orSeparateWrapper","orSeparate"],"mappings":"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","sourcesContent":["import React, { useRef, useContext, useCallback, useEffect } from \"react\";\nimport { Typography } from \"@material-ui/core\";\nimport { FormHandles } from \"@unform/core\";\nimport { injectIntl, IntlShape } from \"react-intl\";\nimport * as Yup from \"yup\";\nimport { BrandContext } from \"../../../BrandContext\";\nimport { useProfileContext } from \"../../../ProfileContext\";\nimport { IProfileData } from \"../../../ProfileContext/types\";\nimport useCognitoIdTokenUpdate from \"../../../UserArea/CognitoIdTokenUpdate\";\nimport useGa from \"../../../utils/useGa\";\nimport { useAuthAmplifyContext } from \"../../contexts/AmplifyContext\";\nimport { useLoadingContext } from \"../../contexts/LoadingContext\";\nimport { useRenderSteps } from \"../../contexts/renderSteps\";\nimport { useToast } from \"../../contexts/Toast\";\nimport BtnsSocialLogin from \"../../shared/components/BtnsSocialLogin\";\nimport Form from \"../../shared/components/Form\";\nimport HeaderLogin from \"../../shared/components/HeaderLogin\";\nimport Input from \"../../shared/components/Input\";\nimport InternalButton from \"../../shared/components/InternalButton\";\nimport Loading from \"../../shared/components/Loading\";\nimport SubTitle from \"../../shared/components/SubTitle\";\nimport Terms from \"../../shared/components/Terms\";\nimport Title from \"../../shared/components/Title\";\nimport { useUserData, IUserData } from \"../../shared/hooks/UserContext\";\nimport translate from \"../../shared/i18n/translate\";\nimport api from \"../../shared/services/api\";\nimport getValidationErrors from \"../../shared/utils/getValidationErrors\";\nimport useStyles from \"./styles\";\nimport { usersInProvider } from \"./utils\";\n\ninterface SubmitFormData {\n    email: string;\n    name?: string;\n    lastName?: string;\n    userExists: boolean;\n}\n\ninterface IInternalLogin {\n    intl: IntlShape;\n}\n\ninterface MainScreenProps extends IInternalLogin {\n    onCloseClick?(): void;\n    isModal?: boolean;\n}\n\nconst MainScreen: React.FC<MainScreenProps> = ({ intl, onCloseClick, isModal }) => {\n    const placeHolderEmail = translate({ id: \"MainScreen.placeholderEmail\" });\n    const placeHolderErrorEmail = intl.formatMessage({ id: \"MainScreen.placeHolderErrorEmail\" });\n    const placeHolderEmailRequired = intl.formatMessage({ id: \"MainScreen.placeHolderEmailRequired\" });\n    const errorWarningTitle = intl.formatMessage({ id: \"MainScreen.errorWarningTitle\" });\n    const errorWarningDescription = intl.formatMessage({ id: \"MainScreen.errorWarningDescription\" });\n    const formRef = useRef<FormHandles>(null);\n    const { saveOnGa } = useGa();\n\n    const { renderNewStep, setPreviousStep } = useRenderSteps();\n    const { setAuthAmplify } = useAuthAmplifyContext();\n    const { setUser } = useUserData();\n    const { setLoading, loading } = useLoadingContext();\n    const ctx = useContext(BrandContext);\n    const { addToast } = useToast();\n    const classes = useStyles({});\n    const { deleteCognitoServiceProvider } = useCognitoIdTokenUpdate();\n    const { setProfileData } = useProfileContext();\n    useEffect(() => {\n        deleteCognitoServiceProvider();\n        setProfileData({} as IProfileData)\n    }, []);\n\n    const submitForm = useCallback(async (formData: SubmitFormData) => {\n        try {\n            formRef.current?.setErrors({});\n\n            const schema = Yup.object().shape({\n                email: Yup.string()\n                    .email(placeHolderErrorEmail)\n                    .required(placeHolderEmailRequired)\n            });\n\n            await schema.validate(formData, {\n                abortEarly: false\n            });\n\n            saveOnGa({\n                event: \"login_event\",\n                category: \"Account\",\n                action: \"Form Login\",\n                label: \"login :: email\"\n            });\n\n            setUser(formData as IUserData);\n            setLoading(true);\n\n            let response;\n            try {\n                const email = encodeURIComponent(formData.email);\n                response = await api.get<SubmitFormData>(`/apigw/authentication/${ctx.brand}/user-exists?email=${email}`);\n                const user = usersInProvider(response.data.found);\n\n                setPreviousStep(\"MainScreen\");\n                if (user?.nextStep) {\n                    if (!user.emailConfirmed) {\n                        setAuthAmplify(\"confirmSignUp\");\n                    }\n\n                    renderNewStep(user.nextStep);\n                } else {\n                    renderNewStep(\"ConfirmMainScreen\");\n                }\n            } catch (err) {\n                saveOnGa({\n                    event: \"fluxo_de_cadastro\",\n                    category: \"Account\",\n                    action: \"Registration\",\n                    label: \"alert :: email validation\"\n                });\n                addToast({\n                    type: \"error\",\n                    title: errorWarningTitle,\n                    description: errorWarningDescription\n                });\n            }\n\n            setLoading(false);\n        } catch (err) {\n            if (err instanceof Yup.ValidationError) {\n                formRef.current?.setErrors(getValidationErrors(err));\n\n            }\n        }\n    },\n    [addToast, ctx.brand, errorWarningDescription, errorWarningTitle, placeHolderEmailRequired, placeHolderErrorEmail, renderNewStep, setAuthAmplify, setLoading, setUser]);\n\n    return loading ? (\n        <Loading />\n    ) : (\n        <>\n            <HeaderLogin isModal={isModal} previousStep=\"MainScreen\" onCloseClick={onCloseClick} />\n            <div className={classes.root}>\n                <Form ref={formRef} handleSubmit={submitForm}>\n                    <Title>{translate({ id: \"MainScreen.title\" })}</Title>\n                    <SubTitle>{translate({ id: \"MainScreen.subtitle\" })}</SubTitle>\n                    <div className={classes.inputWrapper}>\n                        <Input name=\"email\" placeholderText={placeHolderEmail} />\n                    </div>\n\n                    <InternalButton type=\"submit\" text={translate({ id: \"MainScreen.btnLogin\" })} />\n\n                    <div className={classes.orSeparateWrapper}>\n                        <Typography variant=\"caption\" className={classes.orSeparate}>\n                            ou\n                        </Typography>\n                    </div>\n                    <BtnsSocialLogin />\n                </Form>\n            </div>\n            <Terms />\n        </>\n    );\n};\n\nexport default injectIntl(MainScreen);\n"]},"metadata":{},"sourceType":"module"}