{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:/Users/felip/OneDrive/Dokumente/cvc/core-master/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nvar _jsxFileName = \"C:\\\\Users\\\\felip\\\\OneDrive\\\\Dokumente\\\\cvc\\\\core-master\\\\src\\\\ProfileContext\\\\index.tsx\",\n    _this = this,\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { createContext, useCallback, useContext, useState } from \"react\";\nimport { BrandContext } from \"../BrandContext\";\nimport { Redirect } from \"../BrandContext/amplify/aws.config\";\nimport api from \"../BrandContext/services/api\";\nimport { useUserDataContext } from \"../UserContext\";\nimport { findCognitoIdToken } from \"../utils\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar ProfileContext = /*#__PURE__*/createContext({});\n\nvar ProfileDataProvider = function ProfileDataProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n  var ctx = useContext(BrandContext);\n\n  var _useUserDataContext = useUserDataContext(),\n      userIdToken = _useUserDataContext.userIdToken;\n\n  var _useState = useState({}),\n      _useState2 = _slicedToArray(_useState, 2),\n      profileData = _useState2[0],\n      setProfileData = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      profileLoading = _useState4[0],\n      setProfileLoading = _useState4[1];\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      isPatchProfileScreen = _useState6[0],\n      setIsPatchProfileScreen = _useState6[1];\n\n  var _useState7 = useState(false),\n      _useState8 = _slicedToArray(_useState7, 2),\n      isRegisterUserProfileStep = _useState8[0],\n      setIsRegisterUserProfileStep = _useState8[1];\n\n  var getProfileInformations = useCallback( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n    var token, profile;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            setProfileLoading(true);\n            _context.prev = 1;\n            token = userIdToken || findCognitoIdToken();\n\n            if (!token) {\n              _context.next = 12;\n              break;\n            }\n\n            api.defaults.headers.authorization = \"Bearer \".concat(token);\n            _context.next = 7;\n            return api.get(\"\".concat(Redirect(ctx.hosts), \"/api/my-travels-bff/profile\"));\n\n          case 7:\n            profile = _context.sent;\n\n            if (profile.data.userId && profile.data.userId.length > 0) {\n              if (window && window.fingerprint) {\n                window.fingerprint.storeUserId(profile.data.userId);\n              }\n            }\n\n            setProfileData(profile === null || profile === void 0 ? void 0 : profile.data);\n            setProfileLoading(false);\n            return _context.abrupt(\"return\", profile === null || profile === void 0 ? void 0 : profile.data);\n\n          case 12:\n            _context.next = 17;\n            break;\n\n          case 14:\n            _context.prev = 14;\n            _context.t0 = _context[\"catch\"](1);\n            // precisamos tratar essa\n            setProfileLoading(false);\n\n          case 17:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[1, 14]]);\n  })), [ctx.hosts, userIdToken]);\n  var patchProfile = useCallback( /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(_ref3) {\n      var birthdate, contact, cpf, name, acceptedMaisCVC, data;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              birthdate = _ref3.birthdate, contact = _ref3.contact, cpf = _ref3.cpf, name = _ref3.name, acceptedMaisCVC = _ref3.acceptedMaisCVC;\n              setProfileLoading(true);\n              data = {\n                name: name,\n                birthdate: birthdate,\n                cpf: cpf,\n                contact: contact,\n                acceptedMaisCVC: acceptedMaisCVC\n              };\n              _context2.prev = 3;\n              api.defaults.headers.authorization = \"Bearer \".concat(userIdToken);\n              _context2.next = 7;\n              return api.patch(\"\".concat(Redirect(ctx.hosts), \"/api/my-travels-bff/profile\"), data);\n\n            case 7:\n              _context2.next = 9;\n              return getProfileInformations();\n\n            case 9:\n              setProfileLoading(false);\n              _context2.next = 16;\n              break;\n\n            case 12:\n              _context2.prev = 12;\n              _context2.t0 = _context2[\"catch\"](3);\n              console.log(\"Erro: \", _context2.t0); // Tratar esse erro com o Mauricio amanha\n\n              setProfileLoading(false);\n\n            case 16:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[3, 12]]);\n    }));\n\n    return function (_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }(), [userIdToken, getProfileInformations]);\n  var setIsPatchProfileScreenToggle = useCallback(function (isProfileScreen) {\n    setIsPatchProfileScreen(isProfileScreen);\n  }, []);\n  var setIsRegisterUserProfileStepToggle = useCallback(function (isRegisterProfile) {\n    setIsRegisterUserProfileStep(isRegisterProfile);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(ProfileContext.Provider, {\n    value: {\n      profileData: profileData,\n      getProfileInformations: getProfileInformations,\n      patchProfile: patchProfile,\n      profileLoading: profileLoading,\n      isPatchProfileScreen: isPatchProfileScreen,\n      setIsPatchProfileScreenToggle: setIsPatchProfileScreenToggle,\n      isRegisterUserProfileStep: isRegisterUserProfileStep,\n      setIsRegisterUserProfileStepToggle: setIsRegisterUserProfileStepToggle,\n      setProfileData: setProfileData\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 9\n  }, _this);\n};\n\n_s(ProfileDataProvider, \"XhkUKCab+lLCogH/utTlDnVUEVs=\", false, function () {\n  return [useUserDataContext];\n});\n\n_c = ProfileDataProvider;\n\nfunction useProfileContext() {\n  _s2();\n\n  var context = useContext(ProfileContext);\n  return context;\n}\n\n_s2(useProfileContext, \"b9L3QQ+jgeyIrH0NfHrJ8nn7VMU=\");\n\nexport { ProfileDataProvider, useProfileContext };\n\nvar _c;\n\n$RefreshReg$(_c, \"ProfileDataProvider\");","map":{"version":3,"sources":["C:/Users/felip/OneDrive/Dokumente/cvc/core-master/src/ProfileContext/index.tsx"],"names":["React","createContext","useCallback","useContext","useState","BrandContext","Redirect","api","useUserDataContext","findCognitoIdToken","ProfileContext","ProfileDataProvider","children","ctx","userIdToken","profileData","setProfileData","profileLoading","setProfileLoading","isPatchProfileScreen","setIsPatchProfileScreen","isRegisterUserProfileStep","setIsRegisterUserProfileStep","getProfileInformations","token","defaults","headers","authorization","get","hosts","profile","data","userId","length","window","fingerprint","storeUserId","patchProfile","birthdate","contact","cpf","name","acceptedMaisCVC","patch","console","log","setIsPatchProfileScreenToggle","isProfileScreen","setIsRegisterUserProfileStepToggle","isRegisterProfile","useProfileContext","context"],"mappings":"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","sourcesContent":["import React, { createContext, ReactNode, useCallback, useContext, useEffect, useState } from \"react\";\nimport { BrandContext } from \"../BrandContext\"\nimport { Redirect } from \"../BrandContext/amplify/aws.config\"\nimport api from \"../BrandContext/services/api\";\nimport { useToast } from \"../MyTravelLogin/contexts/Toast\";\nimport { useUserDataContext } from \"../UserContext\";\nimport { findCognitoIdToken } from \"../utils\";\nimport { IPatchProfile, IProfileContext, IProfileData } from \"./types\";\n\nconst ProfileContext = createContext<IProfileContext>({} as IProfileContext);\n\ninterface IProfileProvider {\n    children: ReactNode;\n}\n\nconst ProfileDataProvider: React.FC<IProfileProvider> = ({ children }: IProfileProvider) => {\n    const ctx = useContext(BrandContext);\n    const {userIdToken} = useUserDataContext()\n    const [profileData, setProfileData] = useState<IProfileData>({} as IProfileData);\n    const [profileLoading, setProfileLoading] = useState(false)\n    const [isPatchProfileScreen, setIsPatchProfileScreen] = useState(false)\n    const [isRegisterUserProfileStep, setIsRegisterUserProfileStep] = useState(false)\n\n    const getProfileInformations = useCallback(async () => {\n        setProfileLoading(true)\n        try {\n            const token = userIdToken || findCognitoIdToken()\n            if(token){\n                api.defaults.headers.authorization = `Bearer ${token}`;\n                const profile =  await api.get(`${Redirect(ctx.hosts)}/api/my-travels-bff/profile`)\n                if (profile.data.userId && profile.data.userId.length > 0) {\n                    if((window as any) && (window as any).fingerprint) {\n                        (window as any).fingerprint.storeUserId(profile.data.userId);\n                    }\n                }\n                setProfileData(profile?.data)\n                setProfileLoading(false)\n                return profile?.data\n            }\n        } catch {\n            // precisamos tratar essa\n            setProfileLoading(false)\n        }\n\n    }, [ctx.hosts, userIdToken]);\n\n    const patchProfile = useCallback(async({birthdate, contact, cpf, name, acceptedMaisCVC}: IPatchProfile) => {\n        setProfileLoading(true)\n        const data = {\n            name,\n            birthdate,\n            cpf,\n            contact,\n            acceptedMaisCVC\n        }\n        try {\n            api.defaults.headers.authorization = `Bearer ${userIdToken}`;\n            await api.patch(`${Redirect(ctx.hosts)}/api/my-travels-bff/profile`, data)\n            await getProfileInformations()\n            setProfileLoading(false)\n        } catch (err){\n            console.log(\"Erro: \", err) // Tratar esse erro com o Mauricio amanha\n            setProfileLoading(false)\n        }\n\n    }, [userIdToken, getProfileInformations])\n\n    const setIsPatchProfileScreenToggle = useCallback((isProfileScreen: boolean) => {\n        setIsPatchProfileScreen(isProfileScreen)\n    }, [])\n\n    const setIsRegisterUserProfileStepToggle = useCallback((isRegisterProfile: boolean)=> {\n        setIsRegisterUserProfileStep(isRegisterProfile)\n    }, [])\n\n    return (\n        <ProfileContext.Provider value={{\n            profileData,\n            getProfileInformations,\n            patchProfile,\n            profileLoading,\n            isPatchProfileScreen,\n            setIsPatchProfileScreenToggle,\n            isRegisterUserProfileStep,\n            setIsRegisterUserProfileStepToggle,\n            setProfileData\n        }}>\n            {children}\n        </ProfileContext.Provider>\n    );\n};\n\nfunction useProfileContext(): IProfileContext {\n    const context = useContext(ProfileContext);\n    return context;\n}\n\nexport { ProfileDataProvider, useProfileContext };\n"]},"metadata":{},"sourceType":"module"}